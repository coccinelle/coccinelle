<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="hevea 2.09">
<style type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding0 tr td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
.lstlisting{font-family:monospace;white-space:pre;margin-right:auto;margin-left:0pt;text-align:left}
</style>
<title>The SmPL Grammar (version 1.0.2
)
</title>
</head>
<body >
<!--HEVEA command line is: /usr/bin/hevea -exec /usr/share/hevea/xxdate.exe main_grammar.tex -->
<!--CUT STYLE article--><!--CUT DEF section 1 --><table class="title"><tr><td style="padding:1ex"><h1 class="titlemain">The SmPL Grammar (version 1.0.2
)</h1><h3 class="titlerest">Research group on Coccinelle</h3><h3 class="titlerest">August 18, 2015</h3></td></tr>
</table><p>This document presents the grammar of the SmPL language used by the
<a href="http://coccinelle.lip6.fr/">Coccinelle tool</a>. For the most
part, the grammar is written using standard notation. In some rules,
however, the left-hand side is in all uppercase letters. These are
macros, which take one or more grammar rule right-hand-sides as
arguments. The grammar also uses some unspecified nonterminals, such
as <span style="font-family:sans-serif">id</span>, <span style="font-family:sans-serif">const</span>, etc. These refer to the sets suggested by
the name, <em>i.e.</em>, <span style="font-family:sans-serif">id</span> refers to the set of possible
C-language identifiers, while <span style="font-family:sans-serif">const</span> refers to the set of
possible C-language constants.</p><p>A square bracket that is surrounded by spaces in the description of a term
should appear explicitly in the term, as in an array reference. On the
other hand, square brackets that surround some other term indicat that the
presence of that term is optional.</p><p>A PDF version of this documentation is available at
<a href="http://coccinelle.lip6.fr/docs/main_grammar.pdf"><span style="font-family:monospace">http://coccinelle.lip6.fr/docs/main_grammar.pdf</span></a>.
</p>
<!--TOC section id="sec1" Program-->
<h2 id="sec1" class="section">1  Program</h2><!--SEC END --><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="program"><span style="color:maroon">program</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#include_cocci"><span style="color:maroon">include_cocci</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><a href="#changeset"><span style="color:maroon">changeset</span></a><sup><span style="color:black"> +</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="include_cocci"><span style="color:maroon">include_cocci</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">include </span><a href="#string"><span style="color:maroon">string</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">using </span><a href="#string"><span style="color:maroon">string</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">using </span><a href="#pathToIsoFile"><span style="color:maroon">pathToIsoFile</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">virtual </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><span style="color:black">(</span><span style="color:blue">, </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:black">)</span><sup><span style="color:black"> *</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="changeset"><span style="color:maroon">changeset</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#metavariables"><span style="color:maroon">metavariables</span></a><span style="color:blue"> </span><a href="#transformation"><span style="color:maroon">transformation</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#script_metavariables"><span style="color:maroon">script_metavariables</span></a><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif">script_code</span></span> </td></tr>
</table></div><p><span style="font-family:sans-serif">script_code</span> is any code in the chosen scripting language. Parsing of
the semantic patch does not check the validity of this code; any errors are
first detected when the code is executed. Furthermore, <span style="font-family:monospace">@</span> should
not be use in this code. Spatch scans the script code for the next
<span style="font-family:monospace">@</span> and considers that to be the beginning of the next rule, even if
<span style="font-family:monospace">@</span> occurs within e.g., a comment.</p><p><span style="font-family:monospace">virtual</span> keyword is used to declare virtual rules. Virtual
rules may be subsequently used as a dependency for the rules in the
SmPL file. Whether a virtual rule is defined or not is controlled by
the <span style="font-family:monospace">-D</span> option on the command line.</p>
<!--TOC section id="sec2" Metavariables for transformations-->
<h2 id="sec2" class="section">2  Metavariables for transformations</h2><!--SEC END --><p>The <a href="#rulename"><span style="color:maroon">rulename</span></a> portion of the metavariable declaration can specify
properties of a rule such as its name, the names of the rules that it
depends on, the isomorphisms to be used in processing the rule, and whether
quantification over paths should be universal or existential. The optional
annotation <span style="font-family:monospace">expression</span> indicates that the pattern is to be considered
as matching an expression, and thus can be used to avoid some parsing
problems.</p><p>The <a href="#metadecl"><span style="color:maroon">metadecl</span></a> portion of the metavariable declaration defines various
types of metavariables that will be used for matching in the transformation
section.</p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="metavariables"><span style="color:maroon">metavariables</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">@@ </span><a href="#metadecl"><span style="color:maroon">metadecl</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> @@</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">@ </span><a href="#rulename"><span style="color:maroon">rulename</span></a><span style="color:blue"> @ </span><a href="#metadecl"><span style="color:maroon">metadecl</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> @@</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="rulename"><span style="color:maroon">rulename</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">extends </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">depends on </span><a href="#dep"><span style="color:maroon">dep</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">[</span><a href="#iso"><span style="color:maroon">iso</span></a><span style="color:black">]</span><span style="color:blue">
</span><span style="color:black">[</span><a href="#disable-iso"><span style="color:maroon">disable-iso</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">[</span><a href="#exists"><span style="color:maroon">exists</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">expression</span><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="dep"><span style="color:maroon">dep</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">!</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">!(</span><a href="#dep"><span style="color:maroon">dep</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">ever </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">never </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#dep"><span style="color:maroon">dep</span></a><span style="color:blue"> &amp;&amp; </span><a href="#dep"><span style="color:maroon">dep</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#dep"><span style="color:maroon">dep</span></a><span style="color:blue"> || </span><a href="#dep"><span style="color:maroon">dep</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">(</span><a href="#dep"><span style="color:maroon">dep</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="iso"><span style="color:maroon">iso</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">using </span><a href="#string"><span style="color:maroon">string</span></a><span style="color:blue"> </span><span style="color:black">(</span><span style="color:blue">, </span><a href="#string"><span style="color:maroon">string</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="disable-iso"><span style="color:maroon">disable-iso</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">disable </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="exists"><span style="color:maroon">exists</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">exists</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">forall</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <a id="COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:maroon">(</span><a id="elem"><span style="color:maroon">elem</span></a><span style="color:maroon">)</span><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#elem"><span style="color:maroon">elem</span></a><span style="color:blue"> </span><span style="color:black">(</span><span style="color:blue">, </span><a href="#elem"><span style="color:maroon">elem</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup> </td></tr>
</table></div><p>The keyword <span style="color:blue">disable</span> is normally used with the names of
isomorphisms defined in standard.iso or whatever isomorphism file has been
included. There are, however, some other isomorphisms that are built into
the implementation of Coccinelle and that can be disabled as well. Their
names are given below. In each case, the text describes the standard
behavior. Using <a href="#disable-iso"><span style="color:maroon">disable-iso</span></a> with the given name disables this behavior.</p><ul class="itemize"><li class="li-itemize">
<span style="color:blue">optional_storage</span>: A SmPL function definition that does not
specify any visibility (i.e., static or extern), or a SmPL variable
declaration that does not specify any storage (i.e., auto, static,
register, or extern), matches a function declaration or variable
declaration with any visibility or storage, respectively.
</li><li class="li-itemize"><span style="color:blue">optional_qualifier</span>: This is similar to <span style="color:blue">optional_storage</span>,
except that here it is the qualifier (i.e., const or volatile) that does
not have to be specified in the SmPL code, but may be present in the C code.
</li><li class="li-itemize"><span style="color:blue">optional_attributes</span>: This is similar to
<span style="color:blue">optional_attributes</span>, except that here is it an attribute (e.g.,
__init) that does not have to be specified in the SmPL code, but may be
present in the C code. <span style="font-weight:bold">Note that this isomorphism is currently
useless, because matching of attributes is not supported, due to the
difficulty of parsing attributes in C code.</span>
</li><li class="li-itemize"><span style="color:blue">value_format</span>: Integers in various formats, e.g., 1 and 0x1, are
considered to be equivalent in the matching process.
</li><li class="li-itemize"><span style="color:blue">optional_declarer_semicolon</span>: Some declarers (top-level terms
that look like function calls but serve to declare some variable) don’t
require a semicolon. This isomorphism allows a SmPL declarer with a semicolon
to match such a C declarer, if no transformation is specified on the SmPL
semicolon.
</li><li class="li-itemize"><span style="color:blue">comm_assoc</span>: An expression of the form <a href="#exp"><span style="color:maroon">exp</span></a> <a href="#bin_op"><span style="color:maroon">bin_op</span></a>
<span style="color:blue">...</span>, where <a href="#bin_op"><span style="color:maroon">bin_op</span></a> is commutative and associative, is
considered to match any top-level sequence of <a href="#bin_op"><span style="color:maroon">bin_op</span></a> operators
containing <a href="#exp"><span style="color:maroon">exp</span></a> as the top-level argument.
</li><li class="li-itemize"><span style="color:blue">prototypes</span>: A rule for transforming a function prototype is
generated when a function header changes.
</li></ul><p>The possible types of metavariable declarations are defined by the grammar
rule below. Metavariables should occur at least once in the transformation
immediately following their declaration. Fresh identifier metavariables
must only be used in <span style="font-family:monospace">+</span> code. These properties are not expressed in
the grammar, but are checked by a subsequent analysis. The metavariables
are designated according to the kind of terms they can match, such as a
statement, an identifier, or an expression. An expression metavariable can
be further constrained by its type. A declaration metavariable matches the
declaration of one or more variables, all sharing the same type
specification (<em>e.g.</em>, <span style="font-family:monospace">int a,b,c=3;</span>). A field metavariable does
the same, but for structure fields.</p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="metadecl"><span style="color:maroon">metadecl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">metavariable </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">fresh identifier </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">identifier </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_regexp"><span style="color:maroon">pmid_with_regexp</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">identifier </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_virt_or_not_eq"><span style="color:maroon">pmid_with_virt_or_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">parameter </span><span style="color:black">[</span><span style="color:blue">list</span><span style="color:black">]</span><span style="color:blue"> </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">parameter list [ </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> ] </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">parameter list [ </span><a href="#const"><span style="color:maroon">const</span></a><span style="color:blue"> ] </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">type </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">statement </span><span style="color:black">[</span><span style="color:blue">list</span><span style="color:black">]</span><span style="color:blue"> </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">declaration </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">field </span><span style="color:black">[</span><span style="color:blue">list</span><span style="color:black">]</span><span style="color:blue"> </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">typedef </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">attribute </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">declarer name </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">declarer </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_regexp"><span style="color:maroon">pmid_with_regexp</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">declarer </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">iterator name </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">iterator </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_regexp"><span style="color:maroon">pmid_with_regexp</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">iterator </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><span style="color:blue">local </span><span style="color:blue">∣</span><span style="color:blue"> global</span><span style="color:black">]</span><span style="color:blue"> idexpression </span><span style="color:black">[</span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><span style="color:blue">local </span><span style="color:blue">∣</span><span style="color:blue"> global</span><span style="color:black">]</span><span style="color:blue"> idexpression </span><span style="color:black">[</span><span style="color:blue"><span style="font-family:monospace">{</span></span><a href="#ctypes"><span style="color:maroon">ctypes</span></a><span style="color:blue"><span style="font-family:monospace">}</span></span><span style="color:blue"> *</span><sup><span style="color:black"> *</span></sup><span style="color:black">]</span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><span style="color:blue">local </span><span style="color:blue">∣</span><span style="color:blue"> global</span><span style="color:black">]</span><span style="color:blue"> idexpression *</span><sup><span style="color:black"> +</span></sup><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">expression list </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">expression *</span><sup><span style="color:black"> +</span></sup><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">expression enum *</span><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">expression struct *</span><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">expression union *</span><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">expression </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_ceq"><span style="color:maroon">pmid_with_not_ceq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">expression list [ </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> ] </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">expression list [ </span><a href="#const"><span style="color:maroon">const</span></a><span style="color:blue"> ] </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> [ ] </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_ceq"><span style="color:maroon">pmid_with_not_ceq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:monospace">{</span></span><a href="#ctypes"><span style="color:maroon">ctypes</span></a><span style="color:blue"><span style="font-family:monospace">}</span></span><span style="color:blue"> *</span><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_ceq"><span style="color:maroon">pmid_with_not_ceq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:monospace">{</span></span><a href="#ctypes"><span style="color:maroon">ctypes</span></a><span style="color:blue"><span style="font-family:monospace">}</span></span><span style="color:blue"> *</span><sup><span style="color:black"> *</span></sup><span style="color:blue"> [ ] </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">constant </span><span style="color:black">[</span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">constant </span><span style="color:black">[</span><span style="color:blue"><span style="font-family:monospace">{</span></span><a href="#ctypes"><span style="color:maroon">ctypes</span></a><span style="color:blue"><span style="font-family:monospace">}</span></span><span style="color:blue"> *</span><sup><span style="color:black"> *</span></sup><span style="color:black">]</span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">position </span><span style="color:black">[</span><span style="color:blue">any</span><span style="color:black">]</span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid_with_not_eq_mid"><span style="color:maroon">pmid_with_not_eq_mid</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">symbol </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">format </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">format list [ </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> ] </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">format list [ </span><a href="#const"><span style="color:maroon">const</span></a><span style="color:blue"> ] </span><a href="#ids"><span style="color:maroon">ids</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">assignment operator </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><span style="color:blue"><span style="font-family:sans-serif">assignopdecl</span></span><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">binary operator </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><span style="color:blue"><span style="font-family:sans-serif">binopdecl</span></span><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="assignopdecl"><span style="color:maroon">assignopdecl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue"> = </span><a href="#assignop_contraint"><span style="color:maroon">assignop_contraint</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="assignop_contraint"><span style="color:maroon">assignop_contraint</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">{</span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#assign_op"><span style="color:maroon">assign_op</span></a><span style="color:blue">)</span><span style="color:blue">}</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#assign_op"><span style="color:maroon">assign_op</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="binopdecl"><span style="color:maroon">binopdecl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue"> = </span><a href="#binop_contraint"><span style="color:maroon">binop_contraint</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="binop_contraint"><span style="color:maroon">binop_contraint</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">{</span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#binary_op"><span style="color:maroon">binary_op</span></a><span style="color:blue">)</span><span style="color:blue">}</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#binary_op"><span style="color:maroon">binary_op</span></a> </td></tr>
</table></div><p>A metavariable declaration local idexpression v means that v is restricted
to be a local variable. If it should just be a variable, but not
necessarily a local one, then drop local. A more complex description of a
location, such as a-&gt;b is considered to be an expression, not an
ideexpression.</p><p>Constant is for constants, such as 27. But it also considers an identifier
that is all capital letters (possibly containing numbers) as a constant as
well, because the names given to macros in Linux usually have this form.</p><p>An identifier is the name of a structure field, a macro, a function, or a
variable. Is is the name of something rather than an expression that has a
value. But an identifier can be used in the position of an expression as
well, where it represents a variable.</p><p>It is possible to specify that an expression list or a parameter list
metavariable should match a specific number of expressions or parameters.</p><p>It is possible to specify some information about the definition of a fresh
identifier. See the wiki.</p><p>A symbol declaration specifies that the provided identifiers should be
considered C identifiers when encountered in the body of the rule.
Identifiers in the body of the rule that are not declared explicitly are
by default considered symbols, thus symbol declarations are optional.</p><p>An attribute declaration indicates a name that should be considered to be
an attribute. It is not possible to match or remove an attribute, only to
add one.</p><p>A position metavariable is used by attaching it using <span style="font-family:monospace">@</span> to any
token, including another metavariable. Its value is the position (file,
line number, etc.) of the code matched by the token. It is also possible
to attach expression, declaration, type, initialiser, and statement
metavariables in this manner. In that case, the metavariable is bound to
the closest enclosing expression, declaration, etc. If such a metavariable
is itself followed by a position metavariable, the position metavariable
applies to the metavariable that it follows, and not to the attached token.
This makes it possible to get eg the starting and ending position of <span style="font-family:monospace">f(...)</span>, by writing <span style="font-family:monospace">f(...)@E@p</span>, for expression metavariable <span style="font-family:monospace">E</span>
and position metavariable <span style="font-family:monospace">p</span>.</p><p>When used, a format or format list metavariable must be enclosed by a pair
of <span style="font-family:monospace">@</span>s. A format metavariable matches the format descriptor part,
i.e., <span style="font-family:monospace">2x</span> in <span style="font-family:monospace">%2x</span>. A format list metavariable matches a
sequence of format descriptors as well as the text between them. Any text
around them is matched as well, if it is not matched by the surrounding
text in the semantic patch. Such text is not partially matched. If the
length of the format list is specified, that indicates the number of
matched format descriptors. It is also possible to use <span style="font-family:monospace">…</span> in
a format string, to match a sequence of text fragments and format
descriptors. This only takes effect if the format string contains format
descriptors. Note that this makes it impossible to require <span style="font-family:monospace">…</span>
to match exactly in a string, if the semantic patch string contains format
descriptors. If that is needed, some processing with a scripting language
would be required. And example for the use of string format metavariables
is found in demos/format.cocci.</p><p>Assignment (resp. binary) operator metavariables match any assignment
(resp. binary) operator. The list of operators that can be matched can
be restrected by adding an operator constraint, i.e. a list of accepted
operators.</p><p>Other kinds of metavariables can also be attached using <span style="font-family:monospace">@</span> to any
token. In this case, the metavariable floats up to the enclosing
appropriate expression. For example, <span style="font-family:monospace">3 +@E 4</span>, where <span style="font-family:monospace">E</span> is an
expression metavariable binds <span style="font-family:monospace">E</span> to <span style="font-family:monospace">3 + 4</span>. A particular case is
<span style="font-family:monospace">Ps@Es</span>, where <span style="font-family:monospace">Ps</span> is a parameter list and <span style="font-family:monospace">Es</span> is an
expression list. This pattern matches a parameter list, and then matches
<span style="font-family:monospace">Es</span> to the list of expressions, ie a possible argument list,
represented by the names of the parameters. Another particular case is
<span style="font-family:monospace">E@S</span>, where <span style="font-family:monospace">E</span> is any expression and <span style="font-family:monospace">S</span> is a statement
metavariable. <span style="font-family:monospace">S</span> matches the closest enclosing statement, which may
be more than what is matches by the semantic match pattern itself.</p><p>Matching of various kinds of format strings within strings is supported.
With the <span style="font-family:monospace">--ibm</span> option, matching of decimal format declarations is
supported, but the length and precision arguments are not interpreted.
Thus it is not possible to match metavariables in these fields. Instead,
the entire format is matched as a single string.</p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="ids"><span style="color:maroon">ids</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="pmid"><span style="color:maroon">pmid</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#mid"><span style="color:maroon">mid</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <a id="mid"><span style="color:maroon">mid</span></a><span style="color:maroon"> </span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">rulename_id</span></span><span style="color:blue">.</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="pmid_with_regexp"><span style="color:maroon">pmid_with_regexp</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue"> =~ </span><a href="#regexp"><span style="color:maroon">regexp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue"> !~ </span><a href="#regexp"><span style="color:maroon">regexp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">!= </span><a href="#id_or_meta"><span style="color:maroon">id_or_meta</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue">
</span><span style="color:black">[</span><span style="color:blue">!= </span><span style="color:blue"><span style="font-family:monospace">{</span></span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#id_or_meta"><span style="color:maroon">id_or_meta</span></a><span style="color:blue">)</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="pmid_with_virt_or_not_eq"><span style="color:maroon">pmid_with_virt_or_not_eq</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">virtual.</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid_with_not_eq"><span style="color:maroon">pmid_with_not_eq</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="pmid_with_not_ceq"><span style="color:maroon">pmid_with_not_ceq</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">!= </span><a href="#id_or_cst"><span style="color:maroon">id_or_cst</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">!= </span><span style="color:blue"><span style="font-family:monospace">{</span></span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#id_or_cst"><span style="color:maroon">id_or_cst</span></a><span style="color:blue">)</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="id_or_cst"><span style="color:maroon">id_or_cst</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">integer</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="id_or_meta"><span style="color:maroon">id_or_meta</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">rulename_id</span></span><span style="color:blue">.</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="pmid_with_not_eq_mid"><span style="color:maroon">pmid_with_not_eq_mid</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">!= </span><a href="#mid"><span style="color:maroon">mid</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#pmid"><span style="color:maroon">pmid</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">!= </span><span style="color:blue"><span style="font-family:monospace">{</span></span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#mid"><span style="color:maroon">mid</span></a><span style="color:blue">)</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span><span style="color:black">]</span> </td></tr>
</table></div><p>Subsequently, we refer to arbitrary metavariables as
<span style="font-family:sans-serif">metaid</span><sup><span style="font-size:small"><span style="font-style:italic">ty</span></span></sup>, where <span style="font-style:italic">ty</span>
indicates the <span style="font-style:italic">metakind</span> used in the declaration of the variable.
For example, <span style="font-family:sans-serif">metaid</span><sup><span style="font-size:small"><span style="font-family:sans-serif">Type</span></span></sup> refers to a metavariable
that was declared using <span style="font-family:monospace">type</span> and stands for any type.</p><p><span style="font-family:monospace">metavariable</span> declares a metavariable for which the parser tried to
figure out the metavariable type based on the usage context. Such a
metavariable must be used consistently. These metavariables cannot be used
in all contexts; specifically, they cannot be used in context that would
make the parsing ambiguous. Some examples are the leftmost term of an
expression, such as the left-hand side of an assignment, or the type in a
variable declaration. These restrictions may seems somewhat arbitrary from
the user’s point of view. Thus, it is better to use metavariables with
metavariable types. If Coccinelle is given the argument <span style="font-family:monospace">-parse_cocci</span>, it will print information about the type that is inferred
for each metavariable.</p><p>The <a href="#ctype"><span style="color:maroon">ctype</span></a> and <a href="#ctypes"><span style="color:maroon">ctypes</span></a> nonterminals are used by both the grammar of
metavariable declarations and the grammar of transformations, and are
defined on page <a href="#types">??</a>.</p><p>An identifier metavariable with <span style="font-family:monospace">virtual</span> as its “rule name” is given
a value on the command line. For example, if a semantic patch contains a
rule that declares an identifier metavariable with the name <span style="font-family:monospace">virtual.alloc</span>, then the command line could contain <span style="font-family:monospace">-D
alloc=kmalloc</span>. There should not be space around the <span style="font-family:monospace">=</span>. An
example is in <span style="font-family:monospace">demos/vm.cocci</span> and <span style="font-family:monospace">demos/vm.c</span>.</p><p>It is possible to give an identifier metavariable a list of constraints
that it should or should not be equal to. If the constraint is a list of
(unquoted) strings, then the value of the metavariable should be the same
as one of the strings, in the case of an equality constraint, or different
from all of the strings, in the case of an inequality constraint. It is
also possible to include inherited identifier metavariables among the
constraints. In the case of a positive constraint, things work in the same
way, but not with respect to the inherited value of the metavariable. On
the other hand, an inequality constraint does not work so well, because the
only value available is the one available in the ciurrent environment. If
the proposed value is different from the one in teh current environment,
but perhaps the same as the one in some other environment, the match will
still succeed.</p><!--TOC paragraph id="sec3" Warning:-->
<h4 id="sec3" class="paragraph">Warning:</h4><!--SEC END --><p> Each metavariable declaration causes the declared
metavariables to be immediately usable, without any inheritance
indication. Thus the following are correct:</p><blockquote class="quote">
<pre class="verbatim">@@
type r.T;
T x;
@@

[...] // some semantic patch code
</pre></blockquote><blockquote class="quote">
<pre class="verbatim">@@
r.T x;
type r.T;
@@

[...] // some semantic patch code
</pre></blockquote><p>But the following is not correct:</p><blockquote class="quote">
<pre class="verbatim">@@
type r.T;
r.T x;
@@

[...] // some semantic patch code
</pre></blockquote><p>This applies to position variables, type metavariables, identifier
metavariables that may be used in specifying a structure type, and
metavariables used in the initialization of a fresh identifier. In the
case of a structure type, any identifier metavariable indeed has to be
declared as an identifier metavariable in advance. The syntax does not
permit <span style="font-family:monospace">r.n</span> as the name of a structure or union type in such a
declaration.</p>
<!--TOC section id="sec4" Metavariables for scripts-->
<h2 id="sec4" class="section">3  Metavariables for scripts</h2><!--SEC END --><p>Metavariables for scripts can only be inherited from transformation rules.
In the spirit of scripting languages such as Python that use dynamic
typing, metavariables for scripts do not include type declarations.</p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="script_metavariables"><span style="color:maroon">script_metavariables</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">@ script:</span><a href="#language"><span style="color:maroon">language</span></a><span style="color:blue"> </span><span style="color:black">[</span><a href="#rulename"><span style="color:maroon">rulename</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">depends on </span><a href="#dep"><span style="color:maroon">dep</span></a><span style="color:black">]</span><span style="color:blue"> @
</span><a href="#script_metadecl"><span style="color:maroon">script_metadecl</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> @@</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">@ initialize:</span><a href="#language"><span style="color:maroon">language</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">depends on </span><a href="#dep"><span style="color:maroon">dep</span></a><span style="color:black">]</span><span style="color:blue"> @
</span><a href="#script_virt_metadecl"><span style="color:maroon">script_virt_metadecl</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> @@</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">@ finalize:</span><a href="#language"><span style="color:maroon">language</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">depends on </span><a href="#dep"><span style="color:maroon">dep</span></a><span style="color:black">]</span><span style="color:blue"> @
</span><a href="#script_virt_metadecl"><span style="color:maroon">script_virt_metadecl</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> @@</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="language"><span style="color:maroon">language</span></a><span style="color:maroon"> </span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">python</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">ocaml</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="script_metadecl"><span style="color:maroon">script_metadecl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> &lt;&lt; </span><span style="color:blue"><span style="font-family:sans-serif">rulename_id</span></span><span style="color:blue">.</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="script_virt_metadecl"><span style="color:maroon">script_virt_metadecl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> &lt;&lt; virtual.</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> ;</span> </td></tr>
</table></div><p>Currently, the only scripting languages that are supported are Python and
OCaml, indicated using <span style="font-family:monospace">python</span> and <span style="font-family:monospace">ocaml</span>, respectively. The
set of available scripting languages may be extended at some point.</p><p>Script rules declared with <span style="color:blue">initialize</span> are run before the treatment of
any file. Script rules declared with <span style="color:blue">finalize</span> are run when the
treatment of all of the files has completed. There can be at most one of
each per scripting language (thus currently at most one of each).
Initialize and finalize script rules do not have access to SmPL
metavariables. Nevertheless, a finalize script rule can access any
variables initialized by the other script rules, allowing information to be
transmitted from the matching process to the finalize rule.</p><p>Initialize and finalize rules do have access to virtual metavariables,
using the usual syntax. As for other scripting language rules, the rule
is not run (and essentially does not exist) if some of the required virtual
metavariables are not bound. In ocaml, a warning is printed in this case.
An example is found in demos/initvirt.cocci.</p><p>A script metavariable that does not specify an origin, using <span style="font-family:monospace">&lt;&lt;</span>,
is newly declared by the script. This metavariable should be assigned to a
string and can be inherited by subsequent rules as an identifier. In
Python, the assignment of such a metavariable <span style="font-style:italic">x</span> should refer to the
metavariable as <span style="font-family:monospace">coccinelle.</span><span style="font-style:italic">x</span>. Examples are in the files
<span style="font-family:monospace">demos/pythontococci.cocci</span> and <span style="font-family:monospace">demos/camltococci.cocci</span>.</p><p>In an ocaml script, the following extended form of <span style="font-style:italic">script_metadecl</span>
may be used:</p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="script_metadecl"><span style="color:maroon">script_metadecl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">(</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue">,</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue">) &lt;&lt; </span><span style="color:blue"><span style="font-family:sans-serif">rulename_id</span></span><span style="color:blue">.</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> &lt;&lt; </span><span style="color:blue"><span style="font-family:sans-serif">rulename_id</span></span><span style="color:blue">.</span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> ;</span> </td></tr>
</table></div><p>In a declaration of the form <span style="font-family:monospace">(</span><span style="font-family:monospace"><span style="font-family:sans-serif">id</span></span><span style="font-family:monospace">,</span><span style="font-family:monospace"><span style="font-family:sans-serif">id</span></span><span style="font-family:monospace">) &lt;&lt;
</span><span style="font-family:monospace"><span style="font-family:sans-serif">rulename_id</span></span><span style="font-family:monospace">.</span><span style="font-family:monospace"><span style="font-family:sans-serif">id</span></span><span style="font-family:monospace"> ;</span>, the left component of <span style="font-family:monospace">(</span><span style="font-family:monospace"><span style="font-family:sans-serif">id</span></span><span style="font-family:monospace">,</span><span style="font-family:monospace"><span style="font-family:sans-serif">id</span></span><span style="font-family:monospace">)</span>
receives a string representation of the value of the inherited metavariable
while the right component receives its abstract syntax tree. The file
<span style="font-family:monospace">parsing_c/ast_c.ml</span> in the Coccinelle implementation gives some
information about the structure of the abstract syntax tree. Either the
left or right component may be replaced by <code>_</code>, indicating that the
string representation or abstract syntax trees representation is not
wanted, respectively.</p><p>The abstract syntax tree of a metavariable declared using <span style="font-family:monospace">metavariable</span> is not available.</p>
<!--TOC section id="sec5" Transformation-->
<h2 id="sec5" class="section">4  Transformation</h2><!--SEC END --><p>The transformation specification essentially has the form of C code, except
that lines to remove are annotated with <code>-</code> in the first column, and
lines to add are annotated with <code>+</code>. A transformation specification
can also use <em>dots</em>, “<code>...</code>”, describing an arbitrary sequence
of function arguments or instructions within a control-flow path.
Implicitly, “<code>...</code>” matches the shortest path between something that
matches the pattern before the dots (or the beginning of the function, if
there is nothing before the dots) and something that matches the pattern
after the dots (or the end of the function, if there is nothing after the
dots). Dots may be modified with a <span style="font-family:monospace">when</span> clause, indicating a pattern
that should not occur anywhere within the matched sequence. <span style="font-family:monospace">when any</span>
removes the aforementioned constraint that “<code>...</code>” matches the
shortest path. Finally, a transformation can specify a disjunction of
patterns, of the form <span style="font-family:monospace">( </span><span style="font-style:italic">pat</span><sub>1</sub><span style="font-family:monospace"> | </span><span style="font-family:monospace"><span style="font-style:italic">…</span></span><span style="font-family:monospace"> |
</span><span style="font-style:italic">pat</span><sub><span style="font-style:italic">n</span></sub><span style="font-family:monospace"> )</span> where each <span style="font-family:monospace">(</span>, <span style="font-family:monospace">|</span> or <span style="font-family:monospace">)</span> is
in column 0 or preceded by <span style="font-family:monospace">\</span>.</p><p>The grammar that we present for the transformation is not actually the
grammar of the SmPL code that can be written by the programmer, but is
instead the grammar of the slice of this consisting of the <span style="font-family:monospace">-</span>
annotated and the unannotated code (the context of the transformed lines),
or the <span style="font-family:monospace">+</span> annotated code and the unannotated code. For example, for
parsing purposes, the following transformation
is split into the two variants shown below and each is parsed
separately.</p><div class="center">
<table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span>   proc_info_func(...) {
<span style="font-size:xx-small">   2</span>     &lt;...
<span style="font-size:xx-small">   3</span> <span style="color:#B7140B">-    hostno</span>
<span style="font-size:xx-small">   4</span> <span style="color:#379907">+    hostptr-&gt;host_no</span>
<span style="font-size:xx-small">   5</span>     ...&gt;
<span style="font-size:xx-small">   6</span>  }</div></td></tr>
</table>
</div><div class="center">
<table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span>   proc_info_func(...) {
<span style="font-size:xx-small">   2</span>     &lt;...
<span style="font-size:xx-small">   3</span> <span style="color:#B7140B">-    hostno</span>
<span style="font-size:xx-small">   4</span>     ...&gt;
<span style="font-size:xx-small">   5</span>  }</div></td><td style="vertical-align:top;text-align:left;" >&nbsp;</td><td style="vertical-align:top;text-align:left;" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span>   proc_info_func(...) {
<span style="font-size:xx-small">   2</span>     &lt;...
<span style="font-size:xx-small">   3</span> <span style="color:#379907">+    hostptr-&gt;host_no</span>
<span style="font-size:xx-small">   4</span>     ...&gt;
<span style="font-size:xx-small">   5</span>  }</div></td></tr>
</table>
</div><p>Requiring that both slices parse correctly ensures that the rule matches
syntactically valid C code and that it produces syntactically valid C code.
The generated parse trees are then merged for use in the subsequent
matching and transformation process.</p><p>The grammar for the minus or plus slice of a transformation is as follows:</p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" >
<a id="transformation"><span style="color:maroon">transformation</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#include"><span style="color:maroon">include</span></a><sup><span style="color:black"> +</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#OPTDOTSEQ"><span style="color:maroon">OPTDOTSEQ</span></a><span style="color:blue">(</span><a href="#top"><span style="color:maroon">top</span></a><span style="color:blue">, </span><a href="#when"><span style="color:maroon">when</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="include"><span style="color:maroon">include</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">#include </span><span style="color:blue"><span style="font-family:sans-serif">include_string</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="top"><span style="color:maroon">top</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#expr"><span style="color:maroon">expr</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#decl_stmt"><span style="color:maroon">decl_stmt</span></a><sup><span style="color:black"> +</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#fundecl"><span style="color:maroon">fundecl</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
  <a id="when"><span style="color:maroon">when</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">when != </span><a href="#when_code"><span style="color:maroon">when_code</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">when = </span><a href="#rule_elem_stmt"><span style="color:maroon">rule_elem_stmt</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">when </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#any_strict"><span style="color:maroon">any_strict</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">when true != </span><a href="#expr"><span style="color:maroon">expr</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">when false != </span><a href="#expr"><span style="color:maroon">expr</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="when_code"><span style="color:maroon">when_code</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#OPTDOTSEQ"><span style="color:maroon">OPTDOTSEQ</span></a><span style="color:blue">(</span><a href="#decl_stmt"><span style="color:maroon">decl_stmt</span></a><sup><span style="color:black"> +</span></sup><span style="color:blue">, </span><a href="#when"><span style="color:maroon">when</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#OPTDOTSEQ"><span style="color:maroon">OPTDOTSEQ</span></a><span style="color:blue">(</span><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:blue">, </span><a href="#when"><span style="color:maroon">when</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="rule_elem_stmt"><span style="color:maroon">rule_elem_stmt</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#one_decl"><span style="color:maroon">one_decl</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">return </span><span style="color:black">[</span><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:black">]</span><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">break;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">continue;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">\(</span><a href="#rule_elem_stmt"><span style="color:maroon">rule_elem_stmt</span></a><span style="color:blue"> </span><span style="color:black">(</span><span style="color:blue">\| </span><a href="#rule_elem_stmt"><span style="color:maroon">rule_elem_stmt</span></a><span style="color:black">)</span><sup><span style="color:black"> +</span></sup><span style="color:blue">\)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="any_strict"><span style="color:maroon">any_strict</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">any</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">strict</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">forall</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">exists</span> </td></tr>
</table></div><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="OPTDOTSEQ"><span style="color:maroon">OPTDOTSEQ</span></a><span style="color:maroon">(</span><a id="grammar_ds"><span style="color:maroon">grammar_ds</span></a><span style="color:maroon">, </span><a id="when_ds"><span style="color:maroon">when_ds</span></a><span style="color:maroon">)</span><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:right;white-space:nowrap"  colspan=3>   
<span style="color:black">[</span><span style="color:blue">... </span><span style="color:black">(</span><a href="#when_ds"><span style="color:maroon">when_ds</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup><span style="color:black">]</span><span style="color:blue"> </span><a href="#grammar_ds"><span style="color:maroon">grammar_ds</span></a><span style="color:blue">
</span><span style="color:black">(</span><span style="color:blue">... </span><span style="color:black">(</span><a href="#when_ds"><span style="color:maroon">when_ds</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><a href="#grammar_ds"><span style="color:maroon">grammar_ds</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup><span style="color:blue">
</span><span style="color:black">[</span><span style="color:blue">... </span><span style="color:black">(</span><a href="#when_ds"><span style="color:maroon">when_ds</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup><span style="color:black">]</span>
  </td></tr>
</table></div><p>Lines may be annotated with an element of the set {<span style="font-family:monospace">-</span>, <span style="font-family:monospace">+</span>,
<span style="font-family:monospace">*</span>} or the singleton <span style="font-family:monospace">?</span>, or one of each set. <span style="font-family:monospace">?</span>
represents at most one match of the given pattern, ie a match of the
pattern is optional. <span style="font-family:monospace">*</span> is used for
semantic match, <em>i.e.</em>, a pattern that highlights the fragments
annotated with <span style="font-family:monospace">*</span>, but does not perform any modification of the
matched code. <span style="font-family:monospace">*</span> cannot be mixed with <span style="font-family:monospace">-</span> and <span style="font-family:monospace">+</span>. There are
some constraints on the use of these annotations:
</p><ul class="itemize"><li class="li-itemize">
Dots, <em>i.e.</em> <span style="font-family:monospace">...</span>, cannot occur on a line marked
<span style="font-family:monospace">+</span>.
</li><li class="li-itemize">Nested dots, <em>i.e.</em>, dots enclosed in <span style="font-family:monospace">&lt;</span> and <span style="font-family:monospace">&gt;</span>, cannot
occur on a line marked <span style="font-family:monospace">+</span>.
</li></ul><p>Each element of a disjunction must be a proper term like an
expression, a statement, an identifier or a declaration. Thus, the
rule on the left below is not a syntactically correct SmPL rule. One may
use the rule on the right instead.</p><div class="center">
<table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span> @@
<span style="font-size:xx-small">   2</span> <span style="color:#379907"><span style="font-weight:bold">type</span></span> T;
<span style="font-size:xx-small">   3</span> T b;
<span style="font-size:xx-small">   4</span> @@
<span style="font-size:xx-small">   5</span> 
<span style="font-size:xx-small">   6</span> (
<span style="font-size:xx-small">   7</span>  writeb(...,
<span style="font-size:xx-small">   8</span> |
<span style="font-size:xx-small">   9</span>  readb(...,
<span style="font-size:xx-small">  10</span> )
<span style="font-size:xx-small">  11</span> <span style="color:#B7140B">-(T)</span>
<span style="font-size:xx-small">  12</span>  b)</div></td><td style="text-align:center;white-space:nowrap" >              </td><td style="text-align:right;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span> @@
<span style="font-size:xx-small">   2</span> <span style="color:#379907"><span style="font-weight:bold">type</span></span> T;
<span style="font-size:xx-small">   3</span> T b;
<span style="font-size:xx-small">   4</span> @@
<span style="font-size:xx-small">   5</span> 
<span style="font-size:xx-small">   6</span> (
<span style="font-size:xx-small">   7</span> read
<span style="font-size:xx-small">   8</span> |
<span style="font-size:xx-small">   9</span> write
<span style="font-size:xx-small">  10</span> )
<span style="font-size:xx-small">  11</span>  (...,
<span style="font-size:xx-small">  12</span> <span style="color:#B7140B">- (T)</span>
<span style="font-size:xx-small">  13</span>   b)</div></td></tr>
</table>
</div><p>Some kinds of terms can only appear in + code. These include comments,
ifdefs, and attributes (<span style="font-family:monospace">__attribute__((...))</span>).</p>
<!--TOC section id="sec6" Types-->
<h2 id="sec6" class="section">5  Types</h2><!--SEC END --><p>
<a id="types"></a></p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" >
<a id="ctypes"><span style="color:maroon">ctypes</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="ctype"><span style="color:maroon">ctype</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#const_vol"><span style="color:maroon">const_vol</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#generic_ctype"><span style="color:maroon">generic_ctype</span></a><span style="color:blue"> *</span><sup><span style="color:black"> *</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#const_vol"><span style="color:maroon">const_vol</span></a><span style="color:black">]</span><span style="color:blue"> void *</span><sup><span style="color:black"> +</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">(</span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><span style="color:black">(</span><span style="color:blue">| </span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="const_vol"><span style="color:maroon">const_vol</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">const</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">volatile</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="generic_ctype"><span style="color:maroon">generic_ctype</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:black">]</span><span style="color:blue"> char</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:black">]</span><span style="color:blue"> short</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:black">]</span><span style="color:blue"> short int</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:black">]</span><span style="color:blue"> int</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:black">]</span><span style="color:blue"> long</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:black">]</span><span style="color:blue"> long int</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:black">]</span><span style="color:blue"> long long</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:black">]</span><span style="color:blue"> long long int</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">double</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">long double</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">float</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">size_t</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">ssize_t</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">ptrdiff_t</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">enum </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> { </span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue">, </span><a href="#exp_whencode"><span style="color:maroon">exp_whencode</span></a><span style="color:blue">)</span><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">,</span><span style="color:black">]</span><span style="color:blue"> }</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><span style="color:blue">struct</span><span style="color:black">|</span><span style="color:blue"> union</span><span style="color:black">]</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">{ </span><a href="#struct_decl_list"><span style="color:maroon">struct_decl_list</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> }</span><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="ctype_qualif"><span style="color:maroon">ctype_qualif</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">unsigned</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">signed</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="struct_decl_list"><span style="color:maroon">struct_decl_list</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#struct_decl_list_start"><span style="color:maroon">struct_decl_list_start</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="struct_decl_list_start"><span style="color:maroon">struct_decl_list_start</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#struct_decl"><span style="color:maroon">struct_decl</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#struct_decl"><span style="color:maroon">struct_decl</span></a><span style="color:blue"> </span><a href="#struct_decl_list_start"><span style="color:maroon">struct_decl_list_start</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">... </span><span style="color:black">[</span><span style="color:blue">when != </span><a href="#struct_decl"><span style="color:maroon">struct_decl</span></a><span style="color:black">]</span><sup><span style="color:blue">†</span></sup><span style="color:blue"> </span><span style="color:black">[</span><a href="#continue_struct_decl_list"><span style="color:maroon">continue_struct_decl_list</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="continue_struct_decl_list"><span style="color:maroon">continue_struct_decl_list</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#struct_decl"><span style="color:maroon">struct_decl</span></a><span style="color:blue"> </span><a href="#struct_decl_list_start"><span style="color:maroon">struct_decl_list_start</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#struct_decl"><span style="color:maroon">struct_decl</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="struct_decl"><span style="color:maroon">struct_decl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#fn_ctype"><span style="color:maroon">fn_ctype</span></a><span style="color:blue"> (* </span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue">) (</span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#name_opt_decl"><span style="color:maroon">name_opt_decl</span></a><span style="color:blue">, </span><span style="color:blue">ε)</span><span style="color:blue">);)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#const_vol"><span style="color:maroon">const_vol</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="d_ident"><span style="color:maroon">d_ident</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> [</span><span style="color:black">[</span><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:black">]</span><span style="color:blue">]</span><sup><span style="color:black"> *</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="fn_ctype"><span style="color:maroon">fn_ctype</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#generic_ctype"><span style="color:maroon">generic_ctype</span></a><span style="color:blue"> *</span><sup><span style="color:black"> *</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">void *</span><sup><span style="color:black"> *</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="name_opt_decl"><span style="color:maroon">name_opt_decl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#decl"><span style="color:maroon">decl</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#ctype"><span style="color:maroon">ctype</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#fn_ctype"><span style="color:maroon">fn_ctype</span></a> </td></tr>
</table></div><p><sup>†</sup> The optional <span style="font-family:monospace">when</span> construct ends at the end of the line.</p>
<!--TOC section id="sec7" Function declarations-->
<h2 id="sec7" class="section">6  Function declarations</h2><!--SEC END --><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" >
<a id="fundecl"><span style="color:maroon">fundecl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#fn_ctype"><span style="color:maroon">fn_ctype</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#funinfo"><span style="color:maroon">funinfo</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><a href="#funid"><span style="color:maroon">funid</span></a><span style="color:blue">
(</span><span style="color:black">[</span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#param"><span style="color:maroon">param</span></a><span style="color:blue">, </span><span style="color:blue">ε)</span><span style="color:black">]</span><span style="color:blue">)
</span><span style="color:blue"><span style="font-family:monospace">{</span></span><span style="color:blue"> </span><span style="color:black">[</span><a href="#stmt_seq"><span style="color:maroon">stmt_seq</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="funproto"><span style="color:maroon">funproto</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#fn_ctype"><span style="color:maroon">fn_ctype</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#funinfo"><span style="color:maroon">funinfo</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><a href="#funid"><span style="color:maroon">funid</span></a><span style="color:blue">
(</span><span style="color:black">[</span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#param"><span style="color:maroon">param</span></a><span style="color:blue">, </span><span style="color:blue">ε)</span><span style="color:black">]</span><span style="color:blue">);</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="funinfo"><span style="color:maroon">funinfo</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">inline</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#storage"><span style="color:maroon">storage</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <a id="storage"><span style="color:maroon">storage</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">static</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">auto</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">register</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">extern</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="funid"><span style="color:maroon">funid</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Id</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#OR"><span style="color:maroon">OR</span></a><span style="color:blue">(</span><a href="#stmt"><span style="color:maroon">stmt</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <a id="param"><span style="color:maroon">param</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#type"><span style="color:maroon">type</span></a><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Param</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">ParamList</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">......</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="decl"><span style="color:maroon">decl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><a href="#id"><span style="color:maroon">id</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#fn_ctype"><span style="color:maroon">fn_ctype</span></a><span style="color:blue"> (* </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue">) (</span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#name_opt_decl"><span style="color:maroon">name_opt_decl</span></a><span style="color:blue">, </span><span style="color:blue">ε)</span><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">void</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Param</span></span></span></sup> </td></tr>
</table></div><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:maroon">(</span><a id="gram_p"><span style="color:maroon">gram_p</span></a><span style="color:maroon">, </span><a id="when_p"><span style="color:maroon">when_p</span></a><span style="color:maroon">)</span><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#gram_p"><span style="color:maroon">gram_p</span></a><span style="color:blue"> </span><span style="color:black">|</span><span style="color:blue"> …</span><span style="color:black">[</span><a href="#when_p"><span style="color:maroon">when_p</span></a><span style="color:black">]</span><span style="color:blue">)</span> </td></tr>
</table></div><p>To match a function it is not necessary to provide all of the annotations
that appear before the function name. For example, the following semantic
patch:</p><div class="lstlisting"><span style="font-size:xx-small">   1</span> @@
<span style="font-size:xx-small">   2</span> @@
<span style="font-size:xx-small">   3</span> 
<span style="font-size:xx-small">   4</span> foo() { ... }</div><p>matches a function declared as follows:</p><div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">static</span> <span style="color:blue">int</span> foo() { <span style="color:blue">return</span> 12; }</div><p>This behavior can be turned off by disabling the <span style="color:blue">optional_storage</span>
isomorphism. If one adds code before a function declaration, then the
effect depends on the kind of code that is added. If the added code is a
function definition or CPP code, then the new code is placed before
all information associated with the function definition, including any
comments preceding the function definition. On the other hand, if the new
code is associated with the function, such as the addition of the keyword
<span style="font-family:monospace">static</span>, the new code is placed exactly where it appears with respect
to the rest of the function definition in the semantic patch. For example,</p><div class="lstlisting"><span style="font-size:xx-small">   1</span> @@
<span style="font-size:xx-small">   2</span> @@
<span style="font-size:xx-small">   3</span> 
<span style="font-size:xx-small">   4</span> + static
<span style="font-size:xx-small">   5</span> foo() { ... }</div><p>causes static to be placed just before the function name. The following
causes it to be placed just before the type</p><div class="lstlisting"><span style="font-size:xx-small">   1</span> @@
<span style="font-size:xx-small">   2</span> <span style="color:#379907"><span style="font-weight:bold">type</span></span> T;
<span style="font-size:xx-small">   3</span> @@
<span style="font-size:xx-small">   4</span> 
<span style="font-size:xx-small">   5</span> + static
<span style="font-size:xx-small">   6</span> T foo() { ... }</div><p>It may be necessary to consider several cases to ensure that the added ode
is placed in the right position. For example, one may need one pattern
that considers that the function is declared <span style="font-family:monospace">inline</span> and another that
considers that it is not.</p><p>Varargs are written in C using <span style="font-family:monospace">…</span>. Unfortunately, this notation
is already used in the semantic patch language. A pattern for a varargs
parameter is written as a sequence of 6 dots.</p><p>The C parser allows functions that have no return type, and assumes that
the return type is <span style="font-family:monospace">int</span>. The support for parsing such functions is
limited. In particular, the parameter list must contain a type for each
parameter, and may not contain varargs.</p>
<!--TOC section id="sec8" Declarations-->
<h2 id="sec8" class="section">7  Declarations</h2><!--SEC END --><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="decl_var"><span style="color:maroon">decl_var</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#type"><span style="color:maroon">type</span></a><span style="color:blue"> </span><span style="color:black">[</span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">[</span><span style="color:black">[</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:black">]</span><span style="color:blue">]</span><span style="color:black">]</span><span style="color:blue">
</span><span style="color:black">]</span><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#common_decl"><span style="color:maroon">common_decl</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#storage"><span style="color:maroon">storage</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#storage"><span style="color:maroon">storage</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">[</span><a href="#const_vol"><span style="color:maroon">const_vol</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue">)</span><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#storage"><span style="color:maroon">storage</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#fn_ctype"><span style="color:maroon">fn_ctype</span></a><span style="color:blue"> ( * </span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue"> ) ( </span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#name_opt_decl"><span style="color:maroon">name_opt_decl</span></a><span style="color:blue">, </span><span style="color:blue">ε)</span><span style="color:blue"> ) = </span><a href="#initialize"><span style="color:maroon">initialize</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">typedef </span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><a href="#typedef_ident"><span style="color:maroon">typedef_ident</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="one_decl"><span style="color:maroon">one_decl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#common_decl"><span style="color:maroon">common_decl</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#storage"><span style="color:maroon">storage</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#storage"><span style="color:maroon">storage</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">[</span><a href="#const_vol"><span style="color:maroon">const_vol</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="common_decl"><span style="color:maroon">common_decl</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#funproto"><span style="color:maroon">funproto</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#storage"><span style="color:maroon">storage</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue"> = </span><a href="#initialize"><span style="color:maroon">initialize</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#storage"><span style="color:maroon">storage</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">[</span><a href="#const_vol"><span style="color:maroon">const_vol</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue"> = </span><a href="#initialize"><span style="color:maroon">initialize</span></a><span style="color:blue"> ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:black">[</span><a href="#storage"><span style="color:maroon">storage</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#fn_ctype"><span style="color:maroon">fn_ctype</span></a><span style="color:blue"> ( * </span><a href="#d_ident"><span style="color:maroon">d_ident</span></a><span style="color:blue"> ) ( </span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#name_opt_decl"><span style="color:maroon">name_opt_decl</span></a><span style="color:blue">, </span><span style="color:blue">ε)</span><span style="color:blue"> ) ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#decl_ident"><span style="color:maroon">decl_ident</span></a><span style="color:blue"> ( </span><span style="color:black">[</span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:blue">)</span><span style="color:black">]</span><span style="color:blue"> ) ;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="initialize"><span style="color:maroon">initialize</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Initialiser</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:monospace">{</span></span><span style="color:blue"> </span><span style="color:black">[</span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#init_list_elem"><span style="color:maroon">init_list_elem</span></a><span style="color:blue">)</span><span style="color:black">]</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="init_list_elem"><span style="color:maroon">init_list_elem</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#designator"><span style="color:maroon">designator</span></a><span style="color:blue"> = </span><a href="#initialize"><span style="color:maroon">initialize</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Initialiser</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">InitialiserList</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> : </span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="designator"><span style="color:maroon">designator</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">. </span><a href="#id"><span style="color:maroon">id</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">[ </span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue"> ]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">[ </span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue"> ... </span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue"> ]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="decl_ident"><span style="color:maroon">decl_ident</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">DeclarerId</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Declarer</span></span></span></sup> </td></tr>
</table></div><p>An initializer for a structure can be ordered or unordered. It is
considered to be unordered if there is at least one key-value pair
initializer, e.g., <span style="font-family:monospace">.x = e</span>.</p><p>A declaration can have <span style="font-style:italic">e.g.</span> the form <span style="font-family:monospace">register x;</span>. In
this case, the variable implicitly has type int, and SmPL code
that declares an int variable will match such a declaration. On the other
hand, the implicit int type has no position. If the SmPL code tries to
record the position of the type, the match will fail.</p>
<!--TOC section id="sec9" Statements-->
<h2 id="sec9" class="section">8  Statements</h2><!--SEC END --><p>The first rule <em>statement</em> describes the various forms of a statement.
The remaining rules implement the constraints that are sensitive to the
context in which the statement occurs: <em>single_statement</em> for a
context in which only one statement is allowed, and <em>decl_statement</em>
for a context in which a declaration, statement, or sequence thereof is
allowed.</p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="stmt"><span style="color:maroon">stmt</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#directive"><span style="color:maroon">directive</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Stmt</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">if (</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue">) </span><a href="#single_stmt"><span style="color:maroon">single_stmt</span></a><span style="color:blue"> </span><span style="color:black">[</span><span style="color:blue">else </span><a href="#single_stmt"><span style="color:maroon">single_stmt</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">for (</span><span style="color:black">[</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:black">]</span><span style="color:blue">; </span><span style="color:black">[</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:black">]</span><span style="color:blue">; </span><span style="color:black">[</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:black">]</span><span style="color:blue">)
</span><a href="#single_stmt"><span style="color:maroon">single_stmt</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">while (</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue">) </span><a href="#single_stmt"><span style="color:maroon">single_stmt</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">do </span><a href="#single_stmt"><span style="color:maroon">single_stmt</span></a><span style="color:blue"> while (</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue">);</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#iter_ident"><span style="color:maroon">iter_ident</span></a><span style="color:blue"> (</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue">) </span><a href="#single_stmt"><span style="color:maroon">single_stmt</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">switch (</span><span style="color:black">[</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:black">]</span><span style="color:blue">) </span><span style="color:blue"><span style="font-family:monospace">{</span></span><a href="#case_line"><span style="color:maroon">case_line</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">return </span><span style="color:black">[</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:black">]</span><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:monospace">{</span></span><span style="color:blue"> </span><span style="color:black">[</span><a href="#stmt_seq"><span style="color:maroon">stmt_seq</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#NEST"><span style="color:maroon">NEST</span></a><span style="color:blue">(</span><a href="#decl_stmt"><span style="color:maroon">decl_stmt</span></a><sup><span style="color:black"> +</span></sup><span style="color:blue">, </span><a href="#when"><span style="color:maroon">when</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#NEST"><span style="color:maroon">NEST</span></a><span style="color:blue">(</span><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:blue">, </span><a href="#when"><span style="color:maroon">when</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">break;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">continue;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue">:</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">goto </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue">;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:monospace">{</span></span><a href="#stmt_seq"><span style="color:maroon">stmt_seq</span></a><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="directive"><span style="color:maroon">directive</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#include"><span style="color:maroon">include</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">#define </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> </span><span style="color:black">[</span><a href="#top"><span style="color:maroon">top</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">#define </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> (</span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue">, </span><span style="color:blue">ε)</span><span style="color:blue">)
</span><span style="color:black">[</span><a href="#top"><span style="color:maroon">top</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">#undef </span><a href="#id"><span style="color:maroon">id</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">#pragma </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> </span><a href="#id"><span style="color:maroon">id</span></a><sup><span style="color:black"> +</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">#pragma </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> (</span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:blue">, </span><span style="color:blue">ε)</span><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">#pragma </span><a href="#id"><span style="color:maroon">id</span></a><span style="color:blue"> ...</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="single_stmt"><span style="color:maroon">single_stmt</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#stmt"><span style="color:maroon">stmt</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#OR"><span style="color:maroon">OR</span></a><span style="color:blue">(</span><a href="#stmt"><span style="color:maroon">stmt</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="decl_stmt"><span style="color:maroon">decl_stmt</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">StmtList</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#decl_var"><span style="color:maroon">decl_var</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#stmt"><span style="color:maroon">stmt</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#OR"><span style="color:maroon">OR</span></a><span style="color:blue">(</span><a href="#stmt_seq"><span style="color:maroon">stmt_seq</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="stmt_seq"><span style="color:maroon">stmt_seq</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#decl_stmt"><span style="color:maroon">decl_stmt</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue">
</span><span style="color:black">[</span><a href="#DOTSEQ"><span style="color:maroon">DOTSEQ</span></a><span style="color:blue">(</span><a href="#decl_stmt"><span style="color:maroon">decl_stmt</span></a><sup><span style="color:black"> +</span></sup><span style="color:blue">,
</span><a href="#when"><span style="color:maroon">when</span></a><span style="color:blue">)</span><span style="color:blue"> </span><a href="#decl_stmt"><span style="color:maroon">decl_stmt</span></a><sup><span style="color:black"> *</span></sup><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#decl_stmt"><span style="color:maroon">decl_stmt</span></a><sup><span style="color:black"> *</span></sup><span style="color:blue">
</span><span style="color:black">[</span><a href="#DOTSEQ"><span style="color:maroon">DOTSEQ</span></a><span style="color:blue">(</span><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:blue">,
</span><a href="#when"><span style="color:maroon">when</span></a><span style="color:blue">)</span><span style="color:blue"> </span><a href="#decl_stmt"><span style="color:maroon">decl_stmt</span></a><sup><span style="color:black"> *</span></sup><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="case_line"><span style="color:maroon">case_line</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">default : </span><a href="#stmt_seq"><span style="color:maroon">stmt_seq</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">case </span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue"> : </span><a href="#stmt_seq"><span style="color:maroon">stmt_seq</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="iter_ident"><span style="color:maroon">iter_ident</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">IteratorId</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Iterator</span></span></span></sup> </td></tr>
</table></div><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="OR"><span style="color:maroon">OR</span></a><span style="color:maroon">(</span><a id="gram_o"><span style="color:maroon">gram_o</span></a><span style="color:maroon">)</span><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">( </span><a href="#gram_o"><span style="color:maroon">gram_o</span></a><span style="color:blue"> </span><span style="color:black">(</span><span style="color:blue"><span style="font-family:monospace">|</span></span><a href="#gram_o"><span style="color:maroon">gram_o</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="DOTSEQ"><span style="color:maroon">DOTSEQ</span></a><span style="color:maroon">(</span><a id="gram_d"><span style="color:maroon">gram_d</span></a><span style="color:maroon">, </span><a id="when_d"><span style="color:maroon">when_d</span></a><span style="color:maroon">)</span><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">…</span><span style="color:black">[</span><a href="#when_d"><span style="color:maroon">when_d</span></a><span style="color:black">]</span><span style="color:blue"> </span><span style="color:black">(</span><a href="#gram_d"><span style="color:maroon">gram_d</span></a><span style="color:blue"> …</span><span style="color:black">[</span><a href="#when_d"><span style="color:maroon">when_d</span></a><span style="color:black">]</span><span style="color:black">)</span><sup><span style="color:black"> *</span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="NEST"><span style="color:maroon">NEST</span></a><span style="color:maroon">(</span><a id="gram_n"><span style="color:maroon">gram_n</span></a><span style="color:maroon">, </span><a id="when_n"><span style="color:maroon">when_n</span></a><span style="color:maroon">)</span><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">&lt;…</span><span style="color:black">[</span><a href="#when_n"><span style="color:maroon">when_n</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#gram_n"><span style="color:maroon">gram_n</span></a><span style="color:blue"> </span><span style="color:black">(</span><span style="color:blue">…</span><span style="color:black">[</span><a href="#when_n"><span style="color:maroon">when_n</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#gram_n"><span style="color:maroon">gram_n</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup><span style="color:blue"> …&gt;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">&lt;+…</span><span style="color:black">[</span><a href="#when_n"><span style="color:maroon">when_n</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#gram_n"><span style="color:maroon">gram_n</span></a><span style="color:blue"> </span><span style="color:black">(</span><span style="color:blue">…</span><span style="color:black">[</span><a href="#when_n"><span style="color:maroon">when_n</span></a><span style="color:black">]</span><span style="color:blue"> </span><a href="#gram_n"><span style="color:maroon">gram_n</span></a><span style="color:black">)</span><sup><span style="color:black"> *</span></sup><span style="color:blue"> …+&gt;</span> </td></tr>
</table></div><p>OR is a macro that generates a disjunction of patterns. The three
tokens <span style="font-family:sans-serif">(</span>, <span style="font-family:sans-serif"><span style="font-family:monospace">|</span></span>, and <span style="font-family:sans-serif">)</span> must appear in the leftmost
column, to differentiate them from the parentheses and bit-or tokens
that can appear within expressions (and cannot appear in the leftmost
column). These token may also be preceded by <span style="font-family:monospace">\</span>
when they are used in an other column. These tokens are furthermore
different from (, ∣, and ), which are part of the grammar
metalanguage.</p>
<!--TOC section id="sec10" Expressions-->
<h2 id="sec10" class="section">9  Expressions</h2><!--SEC END --><p>A nest or a single ellipsis is allowed in some expression contexts, and
causes ambiguity in others. For example, in a sequence <span style="font-family:monospace">…</span><span style="font-family:monospace"><span style="font-style:italic">expr</span></span><span style="font-family:monospace"> …</span>, the nonterminal <span style="font-style:italic">expr</span> must be instantiated as an
explicit C-language expression, while in an array reference,
<span style="font-style:italic">expr</span><sub>1</sub><span style="font-family:monospace"> </span><span style="font-family:monospace">[</span><span style="font-family:monospace"> </span><span style="font-style:italic">expr</span><sub>2</sub><span style="font-family:monospace"> </span><span style="font-family:monospace">]</span>, the
nonterminal <span style="font-style:italic">expr</span><sub>2</sub>, because it is delimited by brackets, can
be also instantiated as <span style="font-family:monospace">…</span>, representing an arbitrary expression. To
distinguish between the various possibilities, we define three nonterminals
for expressions: <em>expr</em> does not allow either top-level nests or
ellipses, <em>nest_expr</em> allows a nest but not an ellipsis, and <em>dot_expr</em> allows both. The EXPR macro is used to express these variants
in a concise way.</p><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="expr"><span style="color:maroon">expr</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#EXPR"><span style="color:maroon">EXPR</span></a><span style="color:blue">(</span><a href="#expr"><span style="color:maroon">expr</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="nest_expr"><span style="color:maroon">nest_expr</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#EXPR"><span style="color:maroon">EXPR</span></a><span style="color:blue">(</span><a href="#nest_expr"><span style="color:maroon">nest_expr</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#NEST"><span style="color:maroon">NEST</span></a><span style="color:blue">(</span><a href="#nest_expr"><span style="color:maroon">nest_expr</span></a><span style="color:blue">, </span><a href="#exp_whencode"><span style="color:maroon">exp_whencode</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#EXPR"><span style="color:maroon">EXPR</span></a><span style="color:blue">(</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#NEST"><span style="color:maroon">NEST</span></a><span style="color:blue">(</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue">, </span><a href="#exp_whencode"><span style="color:maroon">exp_whencode</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">... </span><span style="color:black">[</span><a href="#exp_whencode"><span style="color:maroon">exp_whencode</span></a><span style="color:black">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="EXPR"><span style="color:maroon">EXPR</span></a><span style="color:maroon">(</span><a id="exp"><span style="color:maroon">exp</span></a><span style="color:maroon">)</span><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue"> </span><a href="#assign_op"><span style="color:maroon">assign_op</span></a><span style="color:blue"> </span><a href="#exp"><span style="color:maroon">exp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">AssignOp</span></span></span></sup><span style="color:blue"> </span><a href="#exp"><span style="color:maroon">exp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue">++</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue">–</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#unary_op"><span style="color:maroon">unary_op</span></a><span style="color:blue"> </span><a href="#exp"><span style="color:maroon">exp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue"> </span><a href="#bin_op"><span style="color:maroon">bin_op</span></a><span style="color:blue"> </span><a href="#exp"><span style="color:maroon">exp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">BinOp</span></span></span></sup><span style="color:blue"> </span><a href="#exp"><span style="color:maroon">exp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue"> ? </span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue"> : </span><a href="#exp"><span style="color:maroon">exp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">(</span><a href="#type"><span style="color:maroon">type</span></a><span style="color:blue">) </span><a href="#exp"><span style="color:maroon">exp</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue"> [</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue">]</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue"> . </span><a href="#id"><span style="color:maroon">id</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue"> -&gt; </span><a href="#id"><span style="color:maroon">id</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue">(</span><span style="color:black">[</span><a href="#PARAMSEQ"><span style="color:maroon">PARAMSEQ</span></a><span style="color:blue">(</span><a href="#arg"><span style="color:maroon">arg</span></a><span style="color:blue">, </span><a href="#exp_whencode"><span style="color:maroon">exp_whencode</span></a><span style="color:blue">)</span><span style="color:black">]</span><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#id"><span style="color:maroon">id</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">(</span><a href="#type"><span style="color:maroon">type</span></a><span style="color:blue">) </span><span style="color:blue"><span style="font-family:monospace">{</span></span><span style="color:blue"> </span><a href="#COMMA_LIST"><span style="color:maroon">COMMA_LIST</span></a><span style="color:blue">(</span><a href="#init_list_elem"><span style="color:maroon">init_list_elem</span></a><span style="color:blue">)</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">}</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Exp</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Const</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#const"><span style="color:maroon">const</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">(</span><a href="#dot_expr"><span style="color:maroon">dot_expr</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><a href="#OR"><span style="color:maroon">OR</span></a><span style="color:blue">(</span><a href="#exp"><span style="color:maroon">exp</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="arg"><span style="color:maroon">arg</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#nest_expr"><span style="color:maroon">nest_expr</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">ExpList</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="exp_whencode"><span style="color:maroon">exp_whencode</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">when != </span><a href="#expr"><span style="color:maroon">expr</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="assign_op"><span style="color:maroon">assign_op</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">= </span><span style="color:black">|</span><span style="color:blue"> -= </span><span style="color:black">|</span><span style="color:blue"> += </span><span style="color:black">|</span><span style="color:blue"> *= </span><span style="color:black">|</span><span style="color:blue"> /= </span><span style="color:black">|</span><span style="color:blue"> %=</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">&amp;= </span><span style="color:black">|</span><span style="color:blue"> |= </span><span style="color:black">|</span><span style="color:blue"> <span style="font-family:monospace">^= </span></span><span style="color:black">|</span><span style="color:blue"><span style="font-family:monospace"> &lt;&lt;= </span></span><span style="color:black">|</span><span style="color:blue"><span style="font-family:monospace"> &gt;&gt;=</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="bin_op"><span style="color:maroon">bin_op</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">* </span><span style="color:black">|</span><span style="color:blue"> / </span><span style="color:black">|</span><span style="color:blue"> % </span><span style="color:black">|</span><span style="color:blue"> + </span><span style="color:black">|</span><span style="color:blue"> -</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:monospace">&lt;&lt;</span></span><span style="color:black">|</span><span style="color:blue"><span style="font-family:monospace"> &gt;&gt;</span></span><span style="color:black">|</span><span style="color:blue"><span style="font-family:monospace"> ^ </span></span><span style="color:black">|</span><span style="color:blue"><span style="font-family:monospace"> &amp; </span></span><span style="color:black">|</span><span style="color:blue"><span style="font-family:monospace"> </span></span><span style="color:blue"><span style="font-family:monospace">|</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">&lt; </span><span style="color:black">|</span><span style="color:blue"> &gt; </span><span style="color:black">|</span><span style="color:blue"> &lt;= </span><span style="color:black">|</span><span style="color:blue"> &gt;= </span><span style="color:black">|</span><span style="color:blue"> == </span><span style="color:black">|</span><span style="color:blue"> != </span><span style="color:black">|</span><span style="color:blue"> &amp;&amp; </span><span style="color:black">|</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:monospace">|</span></span><span style="color:blue"><span style="font-family:monospace">|</span></span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="unary_op"><span style="color:maroon">unary_op</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">++ </span><span style="color:black">|</span><span style="color:blue"> – </span><span style="color:black">|</span><span style="color:blue"> &amp; </span><span style="color:black">|</span><span style="color:blue"> * </span><span style="color:black">|</span><span style="color:blue"> + </span><span style="color:black">|</span><span style="color:blue"> - </span><span style="color:black">|</span><span style="color:blue"> !</span> </td></tr>
</table></div>
<!--TOC section id="sec11" Constants, Identifiers and Types for Transformations-->
<h2 id="sec11" class="section">10  Constants, Identifiers and Types for Transformations</h2><!--SEC END --><div class="center"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <a id="const"><span style="color:maroon">const</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#string"><span style="color:maroon">string</span></a> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">[0-9]+</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:center;white-space:nowrap" ><span style="color:black">|</span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">⋯</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="string"><span style="color:maroon">string</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">"[^"]</span><sup><span style="color:black"> *</span></sup><span style="color:blue">"</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="id"><span style="color:maroon">id</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><span style="color:black">|</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Id</span></span></span></sup><span style="color:blue">
</span><span style="color:black">|</span><span style="color:blue"> </span><a href="#OR"><span style="color:maroon">OR</span></a><span style="color:blue">(</span><a href="#stmt"><span style="color:maroon">stmt</span></a><span style="color:blue">)</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="typedef_ident"><span style="color:maroon">typedef_ident</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue"><span style="font-family:sans-serif">id</span></span><span style="color:blue"> </span><span style="color:black">|</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Type</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="type"><span style="color:maroon">type</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><a href="#ctype"><span style="color:maroon">ctype</span></a><span style="color:blue"> </span><span style="color:black">|</span><span style="color:blue"> </span><span style="color:blue"><span style="font-family:sans-serif"><span style="font-style:italic">metaid</span></span></span><sup><span style="color:blue"><span style="font-size:small"><span style="font-family:sans-serif">Type</span></span></span></sup> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="pathToIsoFile"><span style="color:maroon">pathToIsoFile</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">&lt;.*&gt;</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<a id="regexp"><span style="color:maroon">regexp</span></a><span style="color:maroon">
</span></td><td style="text-align:center;white-space:nowrap" ><span style="color:black">  ::=  </span></td><td style="text-align:left;white-space:nowrap" ><span style="color:blue">"[^"]</span><sup><span style="color:black"> *</span></sup><span style="color:blue">"</span> </td></tr>
</table></div>
<!--TOC section id="sec12" Comments and preprocessor directives-->
<h2 id="sec12" class="section">11  Comments and preprocessor directives</h2><!--SEC END --><p>A <code>//</code> or <code>/* */</code> comment that is annotated with + in the
leftmost column is considered to be added code. A <code>//</code> or
<code>/* */</code> comment without such an annotation is considered to be a
comment about the SmPL code, and thus is not matched in the C code.</p><p>The following preprocessor directives can likewise be added. They cannot
be matched against. The entire line is added, but it is not parsed.</p><ul class="itemize"><li class="li-itemize">
<code>if</code>
</li><li class="li-itemize"><code>ifdef</code>
</li><li class="li-itemize"><code>ifndef</code>
</li><li class="li-itemize"><code>else</code>
</li><li class="li-itemize"><code>elif</code>
</li><li class="li-itemize"><code>endif</code>
</li><li class="li-itemize"><code>error</code>
</li><li class="li-itemize"><code>line</code>
</li></ul>
<!--TOC section id="sec13" Command-line semantic match-->
<h2 id="sec13" class="section">12  Command-line semantic match</h2><!--SEC END --><p>It is possible to specify a semantic match on the spatch command line,
using the argument <span style="font-family:monospace">-sp</span>. In such a semantic match, any token
beginning with a capital letter is assumed to be a metavariable of type
<span style="font-family:monospace">metavariable</span>. In this case, the parser must be able to figure out what
kind of metavariable it is. It is also possible to specify the type of a
metavariable by enclosing the type in :’s, concatenated directly to the
metavariable name.</p><p>Some examples of semantic matches that can be given as an argument to <span style="font-family:monospace">-sp</span> are as follows:</p><ul class="itemize"><li class="li-itemize">
<span style="font-family:monospace">f(e)</span>: This only matches the expression <span style="font-family:monospace">f(e)</span>.
</li><li class="li-itemize"><span style="font-family:monospace">f(E)</span>: This matches a call to f with any argument.
</li><li class="li-itemize"><span style="font-family:monospace">F(E)</span>: This gives a parse error; the semantic patch parser
cannot figure out what kind of metavariable <span style="font-family:monospace">F</span> is.
</li><li class="li-itemize"><span style="font-family:monospace">F:identifier:(E)</span>: This matches any one argument function
call.
</li><li class="li-itemize"><span style="font-family:monospace">f:identifier:(e:struct foo *:)</span>: This matches any one
argument function call where the argument has type <span style="font-family:monospace">struct foo
*</span>. Since the types of the metavariables are specified, it is not
necessary for the metavariable names to begin with a capital letter.
</li><li class="li-itemize"><span style="font-family:monospace">F:identifier:(F)</span>: This matches any one argument function call
where the argument is the name of the function itself. This example
shows that it is not necessary to repeat the metavariable type name.
</li><li class="li-itemize"><span style="font-family:monospace">F:identifier:(F:identifier:)</span>: This matches any one argument
function call
where the argument is the name of the function itself. This example
shows that it is possible to repeat the metavariable type name.
</li></ul><p><span style="font-family:monospace">When</span> constraints, <span style="font-style:italic">e.g.</span> <span style="font-family:monospace">when != e</span>, are allowed
but the expression <span style="font-family:monospace">e</span> must be represented as a single token.</p><p>The generated semantic match behaves as though there were a <span style="font-family:monospace">*</span> in front
of every token.</p>
<!--TOC section id="sec14" Iteration-->
<h2 id="sec14" class="section">13  Iteration</h2><!--SEC END --><p>It is possible to iterate Coccinelle, giving the subsequent iterations a
different set of virtual rules or virtual identifier bindings. And example
is found in <span style="font-family:monospace">demos/iteration.cocci</span>. The example shown there is as
follows:</p><blockquote class="quote">
<pre class="verbatim">virtual after_start

@initialize:ocaml@

let tbl = Hashtbl.create(100)

let add_if_not_present from f file =
try let _ = Hashtbl.find tbl (f,file) in ()
with Not_found -&gt;
   Hashtbl.add tbl (f,file) file;
   let it = new iteration() in
   (match file with
     Some fl -&gt; it#set_files [fl]
   | None -&gt; ());
   it#add_virtual_rule After_start;
   it#add_virtual_identifier Err_ptr_function f;
   it#register()
</pre></blockquote><p>The virtual rule <span style="font-family:monospace">after_start</span> is used to distinguish between the
first iteration (in which it is not considered to have matched) and all
others. This is done by not mentioning <span style="font-family:monospace">after_start</span> in the command
line, but adding it on each iteration.</p><p>The main code for performing the iteration is found in the function <span style="font-family:monospace">add_if_not_present</span>, between the lines calling <span style="font-family:monospace">new iteration</span> and
<span style="font-family:monospace">register</span>. <span style="font-family:monospace">New iteration</span> creates a structure representing the
new iteration. <span style="font-family:monospace">set_files</span> sets the list of files to be considered on
the new iteration. If this function is not called, the new iteration
treats the same files as the current iteration. <span style="font-family:monospace">add_virtual_rule A</span>
has the same effect as putting <span style="font-family:monospace">-D a</span> on the command line. Note that
the first letter of the rule name is capitalized, although this is not done
elsewhere. <span style="font-family:monospace">add_virtual_identifier X v</span> has the same effect as
putting <span style="font-family:monospace">-D x=v</span> on the command line. Note again the case change.
<span style="font-family:monospace">extend_virtual_identifiers()</span> (not shown) preserves all virtual
identifiers of the current iteration that are not overridden by calls to
<span style="font-family:monospace">add_virtual_identifier</span>. Finally, the call to <span style="font-family:monospace">register</span> queues
the collected information to trigger a new iteration at some time in the
future.</p><p>Modification is not allowed when using iteration. Thus, it is required to
use the <span style="font-family:monospace">--no-show-diff</span>, unless the semantic patch contains <span style="font-family:monospace">*</span>s
(a semantic match rather than a semantic patch).</p><p>The remainder of the code above uses a hash table to ensure that the same
information is not enqueued more than once. Coccinelle itself provides no
support for this.</p>
<!--TOC section id="sec15" Examples-->
<h2 id="sec15" class="section">14  Examples</h2><!--SEC END --><p>This section presents a range of examples. Each
example is presented along with some C code to which it is
applied. The description explains the rules and the matching process.</p>
<!--TOC subsection id="sec16" Function renaming-->
<h3 id="sec16" class="subsection">14.1  Function renaming</h3><!--SEC END --><p>One of the primary goals of Coccinelle is to perform software
evolution. For instance, Coccinelle could be used to perform function
renaming. In the following example, every occurrence of a call to the
function <span style="font-family:monospace">foo</span> is replaced by a call to the
function <span style="font-family:monospace">bar</span>.<br>

</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >Before</td><td style="text-align:center;white-space:nowrap" >Semantic patch</td><td style="text-align:center;white-space:nowrap" >After </td></tr>
<tr><td style="text-align:center;white-space:nowrap" ><div class="minipage">
<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">#</span>DEFINE TEST <span style="color:#B7140B">"foo"</span>
<span style="font-size:xx-small">   2</span> 
<span style="font-size:xx-small">   3</span> printf(<span style="color:#B7140B">"foo"</span>);
<span style="font-size:xx-small">   4</span> 
<span style="font-size:xx-small">   5</span> <span style="color:blue">int</span> main(<span style="color:blue">int</span> i) {
<span style="font-size:xx-small">   6</span> <span style="color:#379907">//Test</span>
<span style="font-size:xx-small">   7</span>   <span style="color:blue">int</span> k = foo();
<span style="font-size:xx-small">   8</span> 
<span style="font-size:xx-small">   9</span>   <span style="color:blue">if</span>(1) {
<span style="font-size:xx-small">  10</span>     foo();
<span style="font-size:xx-small">  11</span>   } <span style="color:blue">else</span> {
<span style="font-size:xx-small">  12</span>     foo();
<span style="font-size:xx-small">  13</span>   }
<span style="font-size:xx-small">  14</span> 
<span style="font-size:xx-small">  15</span>   foo();
<span style="font-size:xx-small">  16</span> }</div></div></td><td style="text-align:center;white-space:nowrap" ><div class="minipage">


<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">@@
<span style="font-size:xx-small">   2</span> 
<span style="font-size:xx-small">   3</span> @@</span>
<span style="font-size:xx-small">   4</span> 
<span style="font-size:xx-small">   5</span> 
<span style="font-size:xx-small">   6</span> <span style="color:#B7140B">- foo()</span>
<span style="font-size:xx-small">   7</span> <span style="color:#379907">+ bar()</span></div></div></td><td style="text-align:center;white-space:nowrap" ><div class="minipage">
<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">#</span>DEFINE TEST <span style="color:#B7140B">"foo"</span>
<span style="font-size:xx-small">   2</span> 
<span style="font-size:xx-small">   3</span> printf(<span style="color:#B7140B">"foo"</span>);
<span style="font-size:xx-small">   4</span> 
<span style="font-size:xx-small">   5</span> <span style="color:blue">int</span> main(<span style="color:blue">int</span> i) {
<span style="font-size:xx-small">   6</span> <span style="color:#379907">//Test</span>
<span style="font-size:xx-small">   7</span>   <span style="color:blue">int</span> k = bar();
<span style="font-size:xx-small">   8</span> 
<span style="font-size:xx-small">   9</span>   <span style="color:blue">if</span>(1) {
<span style="font-size:xx-small">  10</span>     bar();
<span style="font-size:xx-small">  11</span>   } <span style="color:blue">else</span> {
<span style="font-size:xx-small">  12</span>     bar();
<span style="font-size:xx-small">  13</span>   }
<span style="font-size:xx-small">  14</span> 
<span style="font-size:xx-small">  15</span>   bar();
<span style="font-size:xx-small">  16</span> }</div></div></td></tr>
</table>
<!--TOC subsection id="sec17" Removing a function argument-->
<h3 id="sec17" class="subsection">14.2  Removing a function argument</h3><!--SEC END --><p>Another important kind of evolution is the introduction or deletion of a
function argument. In the following example, the rule <span style="font-family:monospace">rule1</span> looks
for definitions of functions having return type <span style="font-family:monospace">irqreturn_t</span> and
two parameters. A second <em>anonymous</em> rule then looks for calls to the
previously matched functions that have three arguments. The third argument
is then removed to correspond to the new function prototype.<br>

</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">@ rule1 @
<span style="font-size:xx-small">   2</span> identifier fn;
<span style="font-size:xx-small">   3</span> identifier irq, dev_id;
<span style="font-size:xx-small">   4</span> typedef irqreturn_t;
<span style="font-size:xx-small">   5</span> @@</span>
<span style="font-size:xx-small">   6</span> 
<span style="font-size:xx-small">   7</span> static irqreturn_t fn (int irq, void *dev_id)
<span style="font-size:xx-small">   8</span> {
<span style="font-size:xx-small">   9</span>    ...
<span style="font-size:xx-small">  10</span> }
<span style="font-size:xx-small">  11</span> 
<span style="font-size:xx-small">  12</span> <span style="color:blue">@@
<span style="font-size:xx-small">  13</span> identifier rule1.fn;
<span style="font-size:xx-small">  14</span> expression E1, E2, E3;
<span style="font-size:xx-small">  15</span> @@</span>
<span style="font-size:xx-small">  16</span> 
<span style="font-size:xx-small">  17</span>  fn(E1, E2
<span style="font-size:xx-small">  18</span> <span style="color:#B7140B">-  ,E3</span>
<span style="font-size:xx-small">  19</span>    )</div></td></tr>
</table><p><br>
<br>
<br>
</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" > <span style="font-family:monospace">drivers/atm/firestream.c</span> at line 1653 before transformation</td></tr>
<tr><td style="text-align:center;white-space:nowrap" >


<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">static</span> <span style="color:blue">void</span> fs_poll (<span style="color:blue">unsigned</span> <span style="color:blue">long</span> data)
<span style="font-size:xx-small">   2</span> {
<span style="font-size:xx-small">   3</span>         <span style="color:blue">struct</span> fs_dev *dev = (<span style="color:blue">struct</span> fs_dev *) data;
<span style="font-size:xx-small">   4</span> 
<span style="font-size:xx-small">   5</span> <span style="color:#B7140B">        fs_irq (0, dev, NULL);</span>
<span style="font-size:xx-small">   6</span>         dev-&gt;timer.expires = jiffies + FS_POLL_FREQ;
<span style="font-size:xx-small">   7</span>         add_timer (&amp;dev-&gt;timer);
<span style="font-size:xx-small">   8</span> }</div></td></tr>
<tr><td style="text-align:center;white-space:nowrap" ><br>
<br>
<br>

</td></tr>
<tr><td style="text-align:center;white-space:nowrap" > <span style="font-family:monospace">drivers/atm/firestream.c</span> at line 1653 after transformation</td></tr>
<tr><td style="text-align:center;white-space:nowrap" >


<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">static</span> <span style="color:blue">void</span> fs_poll (<span style="color:blue">unsigned</span> <span style="color:blue">long</span> data)
<span style="font-size:xx-small">   2</span> {
<span style="font-size:xx-small">   3</span>         <span style="color:blue">struct</span> fs_dev *dev = (<span style="color:blue">struct</span> fs_dev *) data;
<span style="font-size:xx-small">   4</span> 
<span style="font-size:xx-small">   5</span> <span style="color:#379907">        fs_irq (0, dev);</span>
<span style="font-size:xx-small">   6</span>         dev-&gt;timer.expires = jiffies + FS_POLL_FREQ;
<span style="font-size:xx-small">   7</span>         add_timer (&amp;dev-&gt;timer);
<span style="font-size:xx-small">   8</span> }</div></td></tr>
</table>
<!--TOC subsection id="sec18" Introduction of a macro-->
<h3 id="sec18" class="subsection">14.3  Introduction of a macro</h3><!--SEC END --><p>To avoid code duplication or error prone code, the kernel provides
macros such as <span style="font-family:monospace">BUG_ON</span>, <span style="font-family:monospace">DIV_ROUND_UP</span> and
<span style="font-family:monospace">FIELD_SIZE</span>. In these cases, the semantic patches look for
the old code pattern and replace it by the new code.<br>

A semantic patch to introduce uses of the <span style="font-family:monospace">DIV_ROUND_UP</span> macro
looks for the corresponding expression, <em>i.e.</em>, (<span style="font-style:italic">n</span> + <span style="font-style:italic">d</span> − 1) /
<span style="font-style:italic">d</span>. When some code is matched, the metavariables <span style="font-family:monospace">n</span> and <span style="font-family:monospace">d</span>
are bound to their corresponding expressions. Finally, Coccinelle rewrites
the code with the <span style="font-family:monospace">DIV_ROUND_UP</span> macro using the values bound to
<span style="font-family:monospace">n</span> and <span style="font-family:monospace">d</span>, as illustrated in the patch that follows.<br>

</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >Semantic patch to introduce uses of the <span style="font-family:monospace">DIV_ROUND_UP</span> macro</td></tr>
<tr><td style="text-align:center;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">@ haskernel @
<span style="font-size:xx-small">   2</span> @@</span>
<span style="font-size:xx-small">   3</span> 
<span style="font-size:xx-small">   4</span> #include &lt;linux/kernel.h&gt;
<span style="font-size:xx-small">   5</span> 
<span style="font-size:xx-small">   6</span> <span style="color:blue">@ depends on haskernel @
<span style="font-size:xx-small">   7</span> expression n,d;
<span style="font-size:xx-small">   8</span> @@</span>
<span style="font-size:xx-small">   9</span> 
<span style="font-size:xx-small">  10</span> (
<span style="font-size:xx-small">  11</span> <span style="color:#B7140B">- (((n) + (d)) - 1) / (d))</span>
<span style="font-size:xx-small">  12</span> <span style="color:#379907">+ DIV_ROUND_UP(n,d)</span>
<span style="font-size:xx-small">  13</span> |
<span style="font-size:xx-small">  14</span> <span style="color:#B7140B">- (((n) + ((d) - 1)) / (d))</span>
<span style="font-size:xx-small">  15</span> <span style="color:#379907">+ DIV_ROUND_UP(n,d)</span>
<span style="font-size:xx-small">  16</span> )</div></td></tr>
</table><p><br>

<br>
<br>
<br>
</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >Example of a generated patch hunk</td></tr>
<tr><td style="text-align:center;white-space:nowrap" >


<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:#B7140B">--- a/drivers/atm/horizon.c</span>
<span style="font-size:xx-small">   2</span> <span style="color:#379907">+++ b/drivers/atm/horizon.c</span>
<span style="font-size:xx-small">   3</span> <span style="color:#7F00FF">@@ -698,7 +698,7 @@ got_it:</span>
<span style="font-size:xx-small">   4</span>                 <span style="color:blue">if</span> (bits)
<span style="font-size:xx-small">   5</span>                         *bits = (div&lt;&lt;CLOCK_SELECT_SHIFT) | (pre-1);
<span style="font-size:xx-small">   6</span>                 <span style="color:blue">if</span> (actual) {
<span style="font-size:xx-small">   7</span> <span style="color:#B7140B">-                       *actual = (br + (pre&lt;&lt;div) - 1) / (pre&lt;&lt;div);</span>
<span style="font-size:xx-small">   8</span> <span style="color:#379907">+                       *actual = DIV_ROUND_UP(br, pre&lt;&lt;div);</span>
<span style="font-size:xx-small">   9</span>                         PRINTD (DBG_QOS, <span style="color:black">"actual rate: %u"</span>, *actual);
<span style="font-size:xx-small">  10</span>                 }
<span style="font-size:xx-small">  11</span>                 <span style="color:blue">return</span> 0;</div></td></tr>
</table><p><br>

</p><p>The <span style="font-family:monospace">BUG_ON</span> macro makes an assertion about the value of an
expression. However, because some parts of the kernel define
<span style="font-family:monospace">BUG_ON</span> to be the empty statement when debugging is not wanted,
care must be taken when the asserted expression may have some side-effects,
as is the case of a function call. Thus, we create a rule introducing
<span style="font-family:monospace">BUG_ON</span> only in the case when the asserted expression does not
perform a function call.</p><p>One particular piece of code that has the form of a function call is a use
of <span style="font-family:monospace">unlikely</span>, which informs the compiler that a particular
expression is unlikely to be true. In this case, because <span style="font-family:monospace">unlikely</span>
does not perform any side effect, it is safe to use <span style="font-family:monospace">BUG_ON</span>. The
second rule takes care of this case. It furthermore disables the
isomorphism that allows a call to <span style="font-family:monospace">unlikely</span> to be replaced with its
argument, as then the second rule would be the same as the first one.<br>

</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">@@
<span style="font-size:xx-small">   2</span> expression E,f;
<span style="font-size:xx-small">   3</span> @@</span>
<span style="font-size:xx-small">   4</span> 
<span style="font-size:xx-small">   5</span> (
<span style="font-size:xx-small">   6</span>   if (&lt;+... f(...) ...+&gt;) { BUG(); }
<span style="font-size:xx-small">   7</span> |
<span style="font-size:xx-small">   8</span> <span style="color:#B7140B">- if (E) { BUG(); }</span>
<span style="font-size:xx-small">   9</span> <span style="color:#379907">+ BUG_ON(E);</span>
<span style="font-size:xx-small">  10</span> )
<span style="font-size:xx-small">  11</span> 
<span style="font-size:xx-small">  12</span> <span style="color:blue">@ disable unlikely @
<span style="font-size:xx-small">  13</span> expression E,f;
<span style="font-size:xx-small">  14</span> @@</span>
<span style="font-size:xx-small">  15</span> 
<span style="font-size:xx-small">  16</span> (
<span style="font-size:xx-small">  17</span>   if (&lt;+... f(...) ...+&gt;) { BUG(); }
<span style="font-size:xx-small">  18</span> |
<span style="font-size:xx-small">  19</span> <span style="color:#B7140B">- if (unlikely(E)) { BUG(); }</span>
<span style="font-size:xx-small">  20</span> <span style="color:#379907">+ BUG_ON(E);</span>
<span style="font-size:xx-small">  21</span> )</div></td></tr>
</table><p><br>

For instance, using the semantic patch above, Coccinelle generates
patches like the following one.</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >


<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:#B7140B">--- a/fs/ext3/balloc.c</span>
<span style="font-size:xx-small">   2</span> <span style="color:#379907">+++ b/fs/ext3/balloc.c</span>
<span style="font-size:xx-small">   3</span> <span style="color:#7F00FF">@@ -232,8 +232,7 @@ restart:</span>
<span style="font-size:xx-small">   4</span>                 prev = rsv;
<span style="font-size:xx-small">   5</span>         }
<span style="font-size:xx-small">   6</span>         printk(<span style="color:black">"Window map complete.\n"</span>);
<span style="font-size:xx-small">   7</span> <span style="color:#B7140B">-       if (bad)</span>
<span style="font-size:xx-small">   8</span> <span style="color:#B7140B">-               BUG();</span>
<span style="font-size:xx-small">   9</span> <span style="color:#379907">+       BUG_ON(bad);</span>
<span style="font-size:xx-small">  10</span>  }
<span style="font-size:xx-small">  11</span>  #define rsv_window_dump(root, verbose) \
<span style="font-size:xx-small">  12</span>         __rsv_window_dump((root), (verbose), __FUNCTION__)</div></td></tr>
</table>
<!--TOC subsection id="sec19" Look for <span style="font-family:monospace">NULL</span> dereference-->
<h3 id="sec19" class="subsection">14.4  Look for <span style="font-family:monospace">NULL</span> dereference</h3><!--SEC END --><p>This SmPL match looks for <span style="font-family:monospace">NULL</span> dereferences. Once an
expression has been compared to <span style="font-family:monospace">NULL</span>, a dereference to this
expression is prohibited unless the pointer variable is reassigned.<br>

</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" > Original </td></tr>
<tr><td style="text-align:center;white-space:nowrap" >
<div class="lstlisting"><span style="font-size:xx-small">   1</span> foo = kmalloc(1024);
<span style="font-size:xx-small">   2</span> <span style="color:blue">if</span> (!foo) {
<span style="font-size:xx-small">   3</span>   printk (<span style="color:#B7140B">"Error %s"</span>, foo-&gt;here);
<span style="font-size:xx-small">   4</span>   <span style="color:blue">return</span>;
<span style="font-size:xx-small">   5</span> }
<span style="font-size:xx-small">   6</span> foo-&gt;ok = 1;
<span style="font-size:xx-small">   7</span> <span style="color:blue">return</span>;</div></td></tr>
</table><p><br>
<br>
<br>
</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" > Semantic match</td></tr>
<tr><td style="text-align:center;white-space:nowrap" >


<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">@@
<span style="font-size:xx-small">   2</span> expression E, E1;
<span style="font-size:xx-small">   3</span> identifier f;
<span style="font-size:xx-small">   4</span> statement S1,S2,S3;
<span style="font-size:xx-small">   5</span> @@</span>
<span style="font-size:xx-small">   6</span> 
<span style="font-size:xx-small">   7</span> <span style="color:#379907">* if (E == NULL)</span>
<span style="font-size:xx-small">   8</span> {
<span style="font-size:xx-small">   9</span>   ... <span style="color:#379907"><span style="font-weight:bold">when</span></span> != if (E == NULL) S1 else S2
<span style="font-size:xx-small">  10</span>       <span style="color:#379907"><span style="font-weight:bold">when</span></span> != E = E1
<span style="font-size:xx-small">  11</span> <span style="color:#379907">* E-&gt;f</span>
<span style="font-size:xx-small">  12</span>   ... <span style="color:#379907"><span style="font-weight:bold">when</span></span> <span style="color:#379907"><span style="font-weight:bold">any</span></span>
<span style="font-size:xx-small">  13</span>   return ...;
<span style="font-size:xx-small">  14</span> }
<span style="font-size:xx-small">  15</span> else S3</div></td></tr>
</table><p><br>
<br>
<br>
</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" > Matched lines</td></tr>
<tr><td style="text-align:center;white-space:nowrap" >



<div class="lstlisting"><span style="font-size:xx-small">   1</span> foo = kmalloc(1024);
<span style="font-size:xx-small">   2</span> <span style="color:#B7140B">if (!foo) {</span>
<span style="font-size:xx-small">   3</span> <span style="color:#B7140B">  printk ("Error %s", foo-&gt;here);</span>
<span style="font-size:xx-small">   4</span>   <span style="color:blue">return</span>;
<span style="font-size:xx-small">   5</span> }
<span style="font-size:xx-small">   6</span> foo-&gt;ok = 1;
<span style="font-size:xx-small">   7</span> <span style="color:blue">return</span>;</div></td></tr>
</table>
<!--TOC subsection id="sec20" Reference counter: the of_xxx API-->
<h3 id="sec20" class="subsection">14.5  Reference counter: the of_xxx API</h3><!--SEC END --><p>Coccinelle can embed Python code. Python code is used inside special
SmPL rule annotated with <span style="font-family:monospace">script:python</span>. Python rules inherit
metavariables, such as identifier or token positions, from other SmPL
rules. The inherited metavariables can then be manipulated by Python
code.</p><p>The following semantic match looks for a call to the
<span style="font-family:monospace">of_find_node_by_name</span> function. This call increments a
counter which must be decremented to release the resource. Then, when
there is no call to <span style="font-family:monospace">of_node_put</span>, no new assignment to the
<span style="font-family:monospace">device_node</span> variable <span style="font-family:monospace">n</span> and a <span style="font-family:monospace">return</span>
statement is reached, a bug is detected and the position <span style="font-family:monospace">p1</span>
and <span style="font-family:monospace">p2</span> are initialized. As the Python only depends on the
positions <span style="font-family:monospace">p1</span> and <span style="font-family:monospace">p2</span>, it is evaluated. In the
following case, some emacs Org mode data are produced. This example
illustrates the various fields that can be accessed in the Python code from
a position variable.</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">@ r exists @
<span style="font-size:xx-small">   2</span> local idexpression struct device_node *n;
<span style="font-size:xx-small">   3</span> position p1, p2;
<span style="font-size:xx-small">   4</span> statement S1,S2;
<span style="font-size:xx-small">   5</span> expression E,E1;
<span style="font-size:xx-small">   6</span> @@</span>
<span style="font-size:xx-small">   7</span> 
<span style="font-size:xx-small">   8</span> (
<span style="font-size:xx-small">   9</span> if (!(n@p1 = of_find_node_by_name(...))) S1
<span style="font-size:xx-small">  10</span> |
<span style="font-size:xx-small">  11</span> n@p1 = of_find_node_by_name(...)
<span style="font-size:xx-small">  12</span> )
<span style="font-size:xx-small">  13</span> &lt;... <span style="color:#379907"><span style="font-weight:bold">when</span></span> != of_node_put(n)
<span style="font-size:xx-small">  14</span>     <span style="color:#379907"><span style="font-weight:bold">when</span></span> != if (...) { &lt;+... of_node_put(n) ...+&gt; }
<span style="font-size:xx-small">  15</span>     <span style="color:#379907"><span style="font-weight:bold">when</span></span> != true !n  || ...
<span style="font-size:xx-small">  16</span>     <span style="color:#379907"><span style="font-weight:bold">when</span></span> != n = E
<span style="font-size:xx-small">  17</span>     <span style="color:#379907"><span style="font-weight:bold">when</span></span> != E = n
<span style="font-size:xx-small">  18</span> if (!n || ...) S2
<span style="font-size:xx-small">  19</span> ...&gt;
<span style="font-size:xx-small">  20</span> (
<span style="font-size:xx-small">  21</span>   return &lt;+...n...+&gt;;
<span style="font-size:xx-small">  22</span> |
<span style="font-size:xx-small">  23</span> return@p2 ...;
<span style="font-size:xx-small">  24</span> |
<span style="font-size:xx-small">  25</span> n = E1
<span style="font-size:xx-small">  26</span> |
<span style="font-size:xx-small">  27</span> E1 = n
<span style="font-size:xx-small">  28</span> )
<span style="font-size:xx-small">  29</span> 
<span style="font-size:xx-small">  30</span> <span style="color:blue">@ script:python @
<span style="font-size:xx-small">  31</span> p1 &lt;&lt; r.p1;
<span style="font-size:xx-small">  32</span> p2 &lt;&lt; r.p2;
<span style="font-size:xx-small">  33</span> @@</span>
<span style="font-size:xx-small">  34</span> 
<span style="font-size:xx-small">  35</span> print "* TODO [[view:%s::face=ovl-face1::linb=%s::colb=%s::cole=%s][inc. counter:%s::%s]]" % (p1[0].file,p1[0].line,p1[0].column,p1[0].column_end,p1[0].file,p1[0].line)
<span style="font-size:xx-small">  36</span> print "[[view:%s::face=ovl-face2::linb=%s::colb=%s::cole=%s][return]]" % (p2[0].file,p2[0].line,p2[0].column,p2[0].column_end)</div></td></tr>
</table><p>Lines 13 to 17 list a variety of constructs that should not appear
between a call to <span style="font-family:monospace">of_find_node_by_name</span> and a buggy return
site. Examples are a call to <span style="font-family:monospace">of_node_put</span> (line 13) and a
transition into the then branch of a conditional testing whether
<span style="font-family:monospace">n</span> is <span style="font-family:monospace">NULL</span> (line 15). Any number of conditionals
testing whether <span style="font-family:monospace">n</span> is <span style="font-family:monospace">NULL</span> are allowed as indicated
by the use of a nest <span style="font-family:monospace">&lt;...  ...&gt;</span> to describe the path between
the call to <span style="font-family:monospace">of_find_node_by_name</span>, the return and the
conditional in the pattern on line 18.<br>

The previous semantic match has been used to generate the following
lines. They may be edited using the emacs Org mode to navigate in the code
from a site to another.</p><div class="lstlisting"><span style="font-size:xx-small">   1</span> * TODO [[view:/linux-next/arch/powerpc/platforms/pseries/setup.c::face=ovl-face1::linb=236::colb=18::cole=20][inc. counter:/linux-next/arch/powerpc/platforms/pseries/setup.c::236]]
<span style="font-size:xx-small">   2</span> [[view:/linux-next/arch/powerpc/platforms/pseries/setup.c::face=ovl-face2::linb=250::colb=3::cole=9][return]]
<span style="font-size:xx-small">   3</span> * TODO [[view:/linux-next/arch/powerpc/platforms/pseries/setup.c::face=ovl-face1::linb=236::colb=18::cole=20][inc. counter:/linux-next/arch/powerpc/platforms/pseries/setup.c::236]]
<span style="font-size:xx-small">   4</span> [[view:/linux-next/arch/powerpc/platforms/pseries/setup.c::face=ovl-face2::linb=245::colb=3::cole=9][return]]</div><p>Note : Coccinelle provides some predefined Python functions,
<em>i.e.</em>, <span style="font-family:monospace">cocci.print_main</span>, <span style="font-family:monospace">cocci.print_sec</span> and
<span style="font-family:monospace">cocci.print_secs</span>. One could alternatively write the following
SmPL rule instead of the previously presented one.</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">@ script:python @
<span style="font-size:xx-small">   2</span> p1 &lt;&lt; r.p1;
<span style="font-size:xx-small">   3</span> p2 &lt;&lt; r.p2;
<span style="font-size:xx-small">   4</span> @@</span>
<span style="font-size:xx-small">   5</span> 
<span style="font-size:xx-small">   6</span> cocci.print_main(p1)
<span style="font-size:xx-small">   7</span> cocci.print_sec(p2,"return")</div></td></tr>
</table><p><br>

The function <span style="font-family:monospace">cocci.print_secs</span> is used when several
positions are matched by a single position variable and
every matched position should be printed.</p><p>Any metavariable could be inherited in the Python code. However,
accessible fields are not currently equally supported among them.</p>
<!--TOC subsection id="sec21" Filtering identifiers, declarers or iterators with regular expressions-->
<h3 id="sec21" class="subsection">14.6  Filtering identifiers, declarers or iterators with regular expressions</h3><!--SEC END --><p>If you consider the following SmPL file which uses the regexp functionality to
filter the identifiers that contain, begin or end by <span style="font-family:monospace">foo</span>,</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">@anyid@
<span style="font-size:xx-small">   2</span> type t;
<span style="font-size:xx-small">   3</span> identifier id;
<span style="font-size:xx-small">   4</span> @@</span>
<span style="font-size:xx-small">   5</span> t id () {...}
<span style="font-size:xx-small">   6</span> 
<span style="font-size:xx-small">   7</span> <span style="color:blue">@script:python@
<span style="font-size:xx-small">   8</span> x &lt;&lt; anyid.id;
<span style="font-size:xx-small">   9</span> @@</span>
<span style="font-size:xx-small">  10</span> print "<span style="color:#379907"><span style="font-weight:bold">Identifier</span></span>: %s" % x
<span style="font-size:xx-small">  11</span> 
<span style="font-size:xx-small">  12</span> <span style="color:blue">@contains@
<span style="font-size:xx-small">  13</span> type t;
<span style="font-size:xx-small">  14</span> identifier foo =~ ".*foo";
<span style="font-size:xx-small">  15</span> @@</span>
<span style="font-size:xx-small">  16</span> t foo () {...}
<span style="font-size:xx-small">  17</span> 
<span style="font-size:xx-small">  18</span> <span style="color:blue">@script:python@
<span style="font-size:xx-small">  19</span> x &lt;&lt; contains.foo;
<span style="font-size:xx-small">  20</span> @@</span>
<span style="font-size:xx-small">  21</span> print "Contains foo: %s" % x</div></td><td style="text-align:center;white-space:nowrap" >      </td><td style="text-align:center;white-space:nowrap" >

<div class="lstlisting"><span style="font-size:xx-small">  23</span> <span style="color:blue">@endsby@
<span style="font-size:xx-small">  24</span> type t;
<span style="font-size:xx-small">  25</span> identifier foo =~ ".*foo$";
<span style="font-size:xx-small">  26</span> @@</span>
<span style="font-size:xx-small">  27</span> 
<span style="font-size:xx-small">  28</span> t foo () {...}
<span style="font-size:xx-small">  29</span> 
<span style="font-size:xx-small">  30</span> <span style="color:blue">@script:python@
<span style="font-size:xx-small">  31</span> x &lt;&lt; endsby.foo;
<span style="font-size:xx-small">  32</span> @@</span>
<span style="font-size:xx-small">  33</span> print "Ends by foo: %s" % x
<span style="font-size:xx-small">  34</span> 
<span style="font-size:xx-small">  35</span> <span style="color:blue">@beginsby@
<span style="font-size:xx-small">  36</span> type t;
<span style="font-size:xx-small">  37</span> identifier foo =~ "^foo";
<span style="font-size:xx-small">  38</span> @@</span>
<span style="font-size:xx-small">  39</span> t foo () {...}
<span style="font-size:xx-small">  40</span> 
<span style="font-size:xx-small">  41</span> <span style="color:blue">@script:python@
<span style="font-size:xx-small">  42</span> x &lt;&lt; beginsby.foo;
<span style="font-size:xx-small">  43</span> @@</span>
<span style="font-size:xx-small">  44</span> print "Begins by foo: %s" % x</div></td></tr>
</table><p><br>

and the following C program, on the left, which defines the functions
<span style="font-family:monospace">foo</span>, <span style="font-family:monospace">bar</span>, <span style="font-family:monospace">foobar</span>, <span style="font-family:monospace">barfoobar</span> and
<span style="font-family:monospace">barfoo</span>, you will get the result on the right.</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:center;white-space:nowrap" ><div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:blue">int</span> foo () { <span style="color:blue">return</span> 0; }
<span style="font-size:xx-small">   2</span> <span style="color:blue">int</span> bar () { <span style="color:blue">return</span> 0; }
<span style="font-size:xx-small">   3</span> <span style="color:blue">int</span> foobar () { <span style="color:blue">return</span> 0; }
<span style="font-size:xx-small">   4</span> <span style="color:blue">int</span> barfoobar () { <span style="color:blue">return</span> 0; }
<span style="font-size:xx-small">   5</span> <span style="color:blue">int</span> barfoo () { <span style="color:blue">return</span> 0; }</div></td><td style="text-align:center;white-space:nowrap" >      </td><td style="text-align:center;white-space:nowrap" ><div class="lstlisting"><span style="font-size:xx-small">   1</span> Identifier: foo
<span style="font-size:xx-small">   2</span> Identifier: bar
<span style="font-size:xx-small">   3</span> Identifier: foobar
<span style="font-size:xx-small">   4</span> Identifier: barfoobar
<span style="font-size:xx-small">   5</span> Identifier: barfoo
<span style="font-size:xx-small">   6</span> Contains foo: foo
<span style="font-size:xx-small">   7</span> Contains foo: foobar
<span style="font-size:xx-small">   8</span> Contains foo: barfoobar
<span style="font-size:xx-small">   9</span> Contains foo: barfoo
<span style="font-size:xx-small">  10</span> Ends by foo: foo
<span style="font-size:xx-small">  11</span> Ends by foo: barfoo
<span style="font-size:xx-small">  12</span> Begins by foo: foo
<span style="font-size:xx-small">  13</span> Begins by foo: foobar</div></td></tr>
</table>
<!--TOC section id="sec22" Tips and Tricks-->
<h2 id="sec22" class="section">15  Tips and Tricks</h2><!--SEC END --><p>This section presents some tips and tricks for using Coccinelle.</p>
<!--TOC subsection id="sec23" How to remove useless parentheses?-->
<h3 id="sec23" class="subsection">15.1  How to remove useless parentheses?</h3><!--SEC END --><p>If you want to rewrite any access to a pointer value by a function
call, you may use the following semantic patch.</p><div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:#B7140B">- a = *b</span>
<span style="font-size:xx-small">   2</span> <span style="color:#379907">+ a = readb(b)</span></div><p>However, if for some reason your code looks like <code>bar = *(foo)</code>,
you will end up with <code>bar = readb((foo))</code> as the extra
parentheses around <span style="font-family:monospace">foo</span> are capture by the metavariable
<span style="font-family:monospace">b</span>.</p><p>In order to generate better output code, you can use the following
semantic patch instead.


</p><div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:#B7140B">- a = *(b)</span>
<span style="font-size:xx-small">   2</span> <span style="color:#379907">+ a = readb(b)</span></div><p>And rely on your standard.iso isomorphism file which should contain:


</p><div class="lstlisting"><span style="font-size:xx-small">   1</span> <span style="color:#379907"><span style="font-weight:bold">Expression</span></span>
<span style="font-size:xx-small">   2</span> @ paren @
<span style="font-size:xx-small">   3</span> <span style="color:#379907"><span style="font-weight:bold">expression</span></span> E;
<span style="font-size:xx-small">   4</span> @@
<span style="font-size:xx-small">   5</span> 
<span style="font-size:xx-small">   6</span>  (E) =&gt; E</div><p>Coccinelle will then consider <code>bar = *(foo)</code> as equivalent to
<code>bar = *foo</code> (but not the other way around) and capture both.
Finally, it will generate <code>bar = readb(foo)</code> as expected.</p><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr style="height:2"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H</em><em><span style="font-size:small"><sup>E</sup></span></em><em>V</em><em><span style="font-size:small"><sup>E</sup></span></em><em>A</em></a><em>.</em></blockquote></body>
</html>
